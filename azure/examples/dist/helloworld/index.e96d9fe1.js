function e(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}var t=globalThis,r={},s={},i=t.parcelRequire8dfc;null==i&&((i=function(e){if(e in r)return r[e].exports;if(e in s){var t=s[e];delete s[e];var i={id:e,exports:{}};return r[e]=i,t.call(i.exports,i,i.exports),i.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){s[e]=t},t.parcelRequire8dfc=i);var o=i.register;o("57pKS",function(t,r){e(t.exports,"twrWasmModule",()=>i("5baAq").twrWasmModule),e(t.exports,"twrWasmModuleAsync",()=>i("U6Thw").twrWasmModuleAsync),e(t.exports,"twrConsoleDiv",()=>i("8wznr").twrConsoleDiv),e(t.exports,"twrConsoleTerminal",()=>i("a7Sa2").twrConsoleTerminal),e(t.exports,"keyEventToCodePoint",()=>i("4Jz48").keyEventToCodePoint),e(t.exports,"twrConsoleDebug",()=>i("9kgjF").twrConsoleDebug),e(t.exports,"twrConsoleCanvas",()=>i("8vcno").twrConsoleCanvas),e(t.exports,"twrLibrary",()=>i("9lAov").twrLibrary),e(t.exports,"twrLibraryInstanceRegistry",()=>i("9lAov").twrLibraryInstanceRegistry),i("jxXdl"),i("5baAq"),i("3tyux"),i("U6Thw"),i("8wznr"),i("a7Sa2"),i("4Jz48"),i("9kgjF"),i("8vcno"),i("9lAov")}),o("jxXdl",function(t,r){e(t.exports,"twrWasmBase",()=>a);var s=i("3tyux"),o=i("7KBfz"),n=i("6QEzV");class a{exports;wasmMem;wasmCall;callC;getImports(e){return{...e,twr_register_callback:this.registerCallback.bind(this)}}async loadWasm(e,t){let r,i;try{if(!(r=await fetch(e)).ok)throw Error("Fetch response error on file '"+e+"'\n"+r.statusText)}catch(t){throw console.log("loadWasm() failed to fetch: "+e),t}try{let e=await r.arrayBuffer();i=await WebAssembly.instantiate(e,{env:this.getImports(t)})}catch(e){throw console.log("Wasm instantiate error: "+e+(e.stack?"\n"+e.stack:"")),e}if(this.exports)throw Error("Unexpected error -- this.exports already set");if(!i.instance.exports)throw Error("Unexpected error - undefined instance.exports");this.exports=i.instance.exports;let n=this.exports.memory;if(!n)throw Error("Unexpected error - undefined exports.memory");let a=this.exports.malloc,l=this.exports.free;this.wasmMem=new s.twrWasmMemory(n,l,a),this.wasmCall=new o.twrWasmCall(this.wasmMem,this.exports),this.callC=this.wasmCall.callC.bind(this.wasmCall)}registerCallback(e){let t=this.wasmMem.getString(e),r=this.exports[t];return(0,n.twrEventQueueReceive).registerCallback(t,r)}}}),o("3tyux",function(t,r){e(t.exports,"twrWasmMemory",()=>n),e(t.exports,"twrWasmMemoryAsync",()=>a);var s=i("lVt1a");class o{memory;mem8;mem16;mem32;memF;memD;constructor(e){this.memory=e,this.mem8=new Uint8Array(e.buffer),this.mem16=new Uint16Array(e.buffer),this.mem32=new Uint32Array(e.buffer),this.memF=new Float32Array(e.buffer),this.memD=new Float64Array(e.buffer)}stringToU8(e,t=s.codePageUTF8){let r;if(t==s.codePageUTF8)r=new TextEncoder().encode(e);else if(t==s.codePage1252){r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=(0,s.to1252)(e[t])}else if(t==s.codePageASCII){r=new Uint8Array(e.length);for(let t=0;t<e.length;t++){let i=(0,s.toASCII)(e[t]);r[t]=i}}else throw Error("unknown codePage: "+t);return r}copyString(e,t,r,i=s.codePageUTF8){let o;if(t<1)throw Error("copyString buffer_size must have length > 0 (room for terminating 0): "+t);let n=this.stringToU8(r,i);for(o=0;o<n.length&&o<t-1;o++)this.mem8[e+o]=n[o];this.mem8[e+o]=0}getLong(e){let t=Math.floor(e/4);if(4*t!=e)throw Error("getLong passed non long aligned address");if(t<0||t>=this.mem32.length)throw Error("invalid index passed to getLong: "+e+", this.mem32.length: "+this.mem32.length);return this.mem32[t]}setLong(e,t){let r=Math.floor(e/4);if(4*r!=e)throw Error("setLong passed non long aligned address");if(r<0||r>=this.mem32.length-1)throw Error("invalid index passed to setLong: "+e+", this.mem32.length: "+this.mem32.length);this.mem32[r]=t}getDouble(e){let t=Math.floor(e/8);if(8*t!=e)throw Error("getLong passed non Float64 aligned address");return this.memD[t]}setDouble(e,t){let r=Math.floor(e/8);if(8*r!=e)throw Error("setDouble passed non Float64 aligned address");this.memD[r]=t}getShort(e){if(e<0||e>=this.mem8.length)throw Error("invalid index passed to getShort: "+e);return this.mem8[e]+256*this.mem8[e+1]}getString(e,t,r=s.codePageUTF8){let i;if(e<0||e>=this.mem8.length)throw Error("invalid strIndex passed to getString: "+e);if(t){if(t<0||t+e>this.mem8.length)throw Error("invalid len  passed to getString: "+t)}else{if(-1==(t=this.mem8.indexOf(0,e)))throw Error("string is not null terminated");t-=e}if(r==s.codePageUTF8)i="utf-8";else if(r==s.codePage1252)i="windows-1252";else throw Error("Unsupported codePage: "+r);let o=new TextDecoder(i),n=new Uint8Array(this.mem8.buffer,e,t);if(this.mem8.buffer instanceof ArrayBuffer)return o.decode(n);{let e=new Uint8Array(new ArrayBuffer(t));return e.set(n),o.decode(e)}}getU8Arr(e){if(e<0||e>=this.mem8.length)throw Error("invalid index passed to getU8: "+e);let t=new Uint32Array(this.mem8.slice(e,e+8).buffer),r=t[0],s=t[1];if(s<0||s>=this.mem8.length)throw Error("invalid idx.dataptr passed to getU8");if(r<0||r>this.mem8.length-s)throw Error("invalid idx.size passed to  getU8");return this.mem8.slice(s,s+r)}getU32Arr(e){if(e<0||e>=this.mem8.length)throw Error("invalid index passed to getU32: "+e);let t=new Uint32Array(this.mem8.slice(e,e+8).buffer),r=t[0],s=t[1];if(s<0||s>=this.mem8.length)throw Error("invalid idx.dataptr passed to getU32");if(r<0||r>this.mem8.length-s)throw Error("invalid idx.size passed to  getU32");if(r%4!=0)throw Error("idx.size is not an integer number of 32 bit words");return new Uint32Array(this.mem8.slice(s,s+r).buffer)}}class n extends o{malloc;free;constructor(e,t,r){super(e),this.free=t,this.malloc=r}putString(e,t=s.codePageUTF8){let r=this.stringToU8(e,t),i=this.malloc(r.length+1);return this.mem8.set(r,i),this.mem8[i+r.length]=0,i}putU8(e){let t=this.malloc(e.length);return this.mem8.set(e,t),t}putArrayBuffer(e){let t=new Uint8Array(e);return this.putU8(t)}}class a extends o{malloc;free;constructor(e,t,r){super(e),this.free=e=>r("free",[e]),this.malloc=t}async putString(e,t=s.codePageUTF8){let r=this.stringToU8(e,t),i=await this.malloc(r.length+1);return this.mem8.set(r,i),this.mem8[i+r.length]=0,i}async putU8(e){let t=await this.malloc(e.length);return this.mem8.set(e,t),t}async putArrayBuffer(e){let t=new Uint8Array(e);return this.putU8(t)}}}),o("lVt1a",function(t,r){e(t.exports,"codePageASCII",()=>o),e(t.exports,"codePage1252",()=>n),e(t.exports,"codePageUTF8",()=>a),e(t.exports,"codePageUTF32",()=>l),e(t.exports,"default",()=>c),e(t.exports,"twrCodePageToUnicodeCodePoint",()=>m),e(t.exports,"to1252",()=>h),e(t.exports,"toASCII",()=>u);var s=i("9lAov");let o=0,n=1252,a=65001,l=12e3;class c extends s.twrLibrary{id;imports={twrUnicodeCodePointToCodePage:{isCommonCode:!0},twrCodePageToUnicodeCodePoint:{isCommonCode:!0},twrUserLanguage:{isCommonCode:!0},twrTimeTmLocal:{isCommonCode:!0},twrUserLconv:{isCommonCode:!0},twrRegExpTest1252:{isCommonCode:!0},twrToUpper1252:{isCommonCode:!0},twrToLower1252:{isCommonCode:!0},twrStrcoll:{isCommonCode:!0},twrGetDtnames:{isCommonCode:!0}};libSourcePath=new URL("file:///../lib-js/twrliblocale.js").pathname;cpTranslate=new m;cpTranslate2=new m;constructor(){super(),this.id=(0,s.twrLibraryInstanceRegistry).register(this)}twrCodePageToUnicodeCodePoint(e,t,r){return this.cpTranslate2.convert(t,r)}twrUnicodeCodePointToCodePage(e,t,r,s){let i=e.wasmMem.stringToU8(String.fromCodePoint(r),s);return e.wasmMem.mem8.set(i,t),i.length}twrUserLanguage(e){return e.wasmMem.putString(navigator.language,o)}twrRegExpTest1252(e,t,r){let s=RegExp(e.wasmMem.getString(t),"u"),i=this.cpTranslate.decoder1252.decode(new Uint8Array([r]));return s.test(i)?1:0}twrToLower1252(e,t){let r=this.cpTranslate.decoder1252.decode(new Uint8Array([t]));return RegExp("^\\p{Letter}$","u").test(r)?h(r.toLocaleLowerCase()):t}twrToUpper1252(e,t){let r=this.cpTranslate.decoder1252.decode(new Uint8Array([t]));return 402==r.codePointAt(0)||181==r.codePointAt(0)||223==r.codePointAt(0)||"µ"==r||"ƒ"==r||"ß"==r?t:RegExp("^\\p{Letter}$","u").test(r)?h(r.toLocaleUpperCase()):t}twrStrcoll(e,t,r,s){let i=e.wasmMem.getString(t,void 0,s),o=e.wasmMem.getString(r,void 0,s);return new Intl.Collator().compare(i,o)}twrTimeTmLocal(e,t,r){let s=new Date(1e3*r);e.wasmMem.setLong(t,s.getSeconds()),e.wasmMem.setLong(t+4,s.getMinutes()),e.wasmMem.setLong(t+8,s.getHours()),e.wasmMem.setLong(t+12,s.getDate()),e.wasmMem.setLong(t+16,s.getMonth()),e.wasmMem.setLong(t+20,s.getFullYear()-1900),e.wasmMem.setLong(t+24,s.getDay()),e.wasmMem.setLong(t+28,this.getDayOfYear(s)),e.wasmMem.setLong(t+32,this.isDst()),e.wasmMem.setLong(t+36,-(60*s.getTimezoneOffset())),e.wasmMem.setLong(t+40,e.wasmMem.putString(this.getTZ(s),o))}getDayOfYear(e){let t=new Date(e.getFullYear(),0,1);return Math.floor((e.getTime()-t.getTime())/864e5)}isDst(){return new Date().toLocaleTimeString("en-US",{timeZoneName:"long"}).includes("Daylight")?1:0}getTZ(e){return e.toLocaleTimeString("en-US",{timeZoneName:"short"}).split(" ").pop()||"UTC"}setAndPutString(e,t,r,s){let i=e.putString(r,s);e.setLong(t,i)}twrUserLconv(e,t,r){let s=this.getLocaleDecimalPoint(),i=this.getLocaleThousandsSeparator();this.setAndPutString(e.wasmMem,t+0,s,r),this.setAndPutString(e.wasmMem,t+4,i,r),this.setAndPutString(e.wasmMem,t+20,s,r),this.setAndPutString(e.wasmMem,t+24,i,r),this.setAndPutString(e.wasmMem,t+24,i,r),this.setAndPutString(e.wasmMem,t+24,i,r),this.setAndPutString(e.wasmMem,t+32,"+",r),this.setAndPutString(e.wasmMem,t+36,"-",r),this.setAndPutString(e.wasmMem,t+12,this.getLocalCurrencySymbol(),r),this.setAndPutString(e.wasmMem,t+16,this.getLocalCurrencySymbol(),r)}getLocaleDecimalPoint(){return new Intl.NumberFormat().format(1.1).replace(/[0-9]/g,"").charAt(0)}getLocaleThousandsSeparator(){return new Intl.NumberFormat(void 0,{minimumFractionDigits:0}).format(1e3).replace(/[0-9]/g,"").charAt(0)}getLocaleCurrencyDecimalPoint(){let e=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).resolvedOptions().currency;return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(1.1).replace(/[0-9]/g,"").charAt(1)}getLocalCurrencySymbol(){switch(navigator.language){case"en-US":case"en-CA":case"fr-CA":case"en-AU":case"es-MX":case"es-AR":case"es-CL":case"es-CO":case"es-EC":case"en-GY":case"nl-SR":case"es-UY":case"en-BZ":case"es-SV":case"es-PA":return"$";case"es-BO":case"es-VE":return"Bs.";case"es-PY":return"₲";case"es-PE":return"S/";case"es-CR":return"₡";case"es-GT":return"Q";case"es-HN":return"L";case"es-NI":return"C$";case"en-GB":return"£";case"en-IE":case"de-DE":case"fr-FR":case"de-AT":case"nl-BE":case"fr-BE":case"el-CY":case"et-EE":case"fi-FI":case"sv-FI":case"el-GR":case"it-IT":case"lv-LV":case"lt-LT":case"fr-LU":case"de-LU":case"lb-LU":case"mt-MT":case"nl-NL":case"pt-PT":case"sk-SK":case"sl-SI":case"es-ES":return"€";case"ja-JP":case"zh-CN":return"¥";case"de-CH":case"fr-CH":case"it-CH":return"CHF";case"sv-SE":case"da-DK":case"nb-NO":return"kr";case"ru-RU":return"₽";case"ko-KR":return"₩";case"en-IN":return"₹";case"pt-BR":return"R$";case"he-IL":return"₪";case"tr-TR":return"₺";default:return""}}twrGetDtnames(e,t){let r=(0,e.wasmMem.malloc)(160);for(let s=0;s<7;s++)this.setAndPutString(e.wasmMem,r+4*s,this.getLocalizedDayName(s,"long"),t);for(let s=0;s<7;s++)this.setAndPutString(e.wasmMem,r+(s+7)*4,this.getLocalizedDayName(s,"short"),t);for(let s=0;s<12;s++)this.setAndPutString(e.wasmMem,r+(s+14)*4,this.getLocalizedMonthNames(s,"long"),t);for(let s=0;s<12;s++)this.setAndPutString(e.wasmMem,r+(s+14+12)*4,this.getLocalizedMonthNames(s,"short"),t);return this.setAndPutString(e.wasmMem,r+152,this.getLocalizedAM(),t),this.setAndPutString(e.wasmMem,r+156,this.getLocalizedPM(),t),r}getLocalizedDayName(e,t){let r=new Date;return r.setDate(r.getDate()-r.getDay()+e),new Intl.DateTimeFormat(void 0,{weekday:t}).format(r)}getLocalizedMonthNames(e,t){let r=new Intl.DateTimeFormat(void 0,{month:t}),s=new Date(2e3,e,1);return r.format(s)}getLocalizedAM(){let e=new Date(2e3,0,1,9,0,0),t=new Intl.DateTimeFormat(void 0,{hour:"numeric",hour12:!0}).formatToParts(e).find(e=>"dayPeriod"===e.type);return t?t.value:""}getLocalizedPM(){let e=new Date(2e3,0,1,15,0,0),t=new Intl.DateTimeFormat(void 0,{hour:"numeric",hour12:!0}).formatToParts(e).find(e=>"dayPeriod"===e.type);return t?t.value:""}}function h(e){if(8239==e.codePointAt(0))return 32;let t=e.codePointAt(0)||0;switch(t){case 338:return 140;case 339:return 156;case 352:return 138;case 353:return 154;case 376:return 159;case 381:return 142;case 382:return 158;case 402:return 131;case 710:return 136}switch(e.normalize()){case"€":return 128;case"‚":return 130;case"ƒ":return 131;case"„":return 132;case"…":return 133;case"†":return 134;case"‡":return 135;case"ˆ":return 136;case"‰":return 137;case"Š":return 138;case"‹":return 139;case"Œ":return 140;case"Ž":return 142;case"‘":return 145;case"’":return 146;case"“":return 147;case"”":return 148;case"•":return 149;case"–":return 150;case"—":return 151;case"˜":return 152;case"™":return 153;case"š":return 154;case"›":return 155;case"œ":return 156;case"ž":return 158;case"Ÿ":return 159}return t>255&&(console.log("twr-wasm.to1252(): unable to convert: ",e,t),t=0),t}function u(e){if("ƒ"==e)return 102;if(8239==e.codePointAt(0))return 32;let t=e.codePointAt(0)||0;return t>127?63:t}class m{decoderUTF8=new TextDecoder("utf-8");decoder1252=new TextDecoder("windows-1252");convert(e,t){let r;if(t==a)r=this.decoderUTF8.decode(new Uint8Array([e]),{stream:!0});else if(t==n)r=this.decoder1252.decode(new Uint8Array([e]));else if(t==o)r=e>127?"":String.fromCharCode(e);else if(t==l)r=String.fromCodePoint(e);else throw Error("unsupported CodePage: "+t);return r.codePointAt(0)||0}}}),o("9lAov",function(t,r){e(t.exports,"twrLibrary",()=>o),e(t.exports,"twrLibraryInstanceRegistry",()=>a),e(t.exports,"twrLibraryProxy",()=>n),e(t.exports,"twrLibraryInstanceProxyRegistry",()=>l);var s=i("6QEzV");class o{interfaceName;constructor(){}getImports(e){if(e.isTwrWasmModuleAsync)throw Error("unsupported module type (expecting twrWasmModule");let t={};if(void 0===this.imports)throw Error("twrLibrary derived class is missing imports.");if(void 0===this.libSourcePath)throw Error("twrLibrary derived class is missing libSourcePath.");for(let r in this.imports)if(this.imports[r].isModuleAsyncOnly){let e=()=>{throw Error("Invalid call to unimplemented twrLibrary 'import' function (isModuleAsyncOnly was used): "+r)};t[r]=e}else{if(!this[r])throw Error("twrLibrary 'import' function is missing: "+r);if(this.interfaceName){let s=(e,t,r,...s)=>{let i=a.getLibraryInstance(r),o=i[e];if(!o)throw Error(`Library function not found. id=${r}, funcName=${e}`);return o.call(i,t,...s)};t[r]=s.bind(null,r,e)}else t[r]=this[r].bind(this,e)}return t}getProxyParams(){return["twrLibraryProxy",this.id,this.imports,this.libSourcePath,this.interfaceName]}async processMessageFromProxy(e,t){let r;let[s,i,o,n,l,...c]=e;if(this.interfaceName&&a.getLibraryInstance(i).libSourcePath!=this.libSourcePath||i!=this.id||!t.isTwrWasmModuleAsync)throw Error("internal error");let h=a.getLibraryInstance(i);if(!h[o])throw Error("twrLibrary derived class missing 'import' function: "+o);r=n?await h[o](t,...c):h[o](t,...c),l>-1&&t.eventQueueSend.postEvent(l,r)}}class n{id;imports;libSourcePath;interfaceName;called=!1;constructor(e){let[t,r,s,i,o]=e;this.id=r,this.imports=s,this.libSourcePath=i,this.interfaceName=o}remoteProcedureCall(e,t,r,s,i,...o){if(postMessage(i?["twrLibrary",o[0],t,r,s,...o.slice(1)]:["twrLibrary",this.id,t,r,s,...o]),-1==s)return 0;let[n,a]=e.eventQueueReceive.waitEvent(s);if(n!=s||1!=a.length)throw Error("internal error");return a[0]}async getProxyImports(e){let t;if(!0===this.called)throw Error("getProxyImports should only be called once per twrLibraryProxy instance");this.called=!0;let r={};for(let i in this.imports)if(this.imports[i].isCommonCode){if(this.imports[i].isAsyncFunction)throw Error("isAsyncFunction can not be used with isCommonCode");if(void 0===t){if(void 0===this.libSourcePath)throw Error("undefined libSourcePath");t=new(await import(this.libSourcePath)).default}r[i]=t[i].bind(t,e)}else this.imports[i].isAsyncFunction?r[i]=this.remoteProcedureCall.bind(this,e,i+"_async",!!this.imports[i].isAsyncFunction,this.imports[i].noBlock?-1:(0,s.twrEventQueueReceive).registerEvent(),this.interfaceName):r[i]=this.remoteProcedureCall.bind(this,e,i,!!this.imports[i].isAsyncFunction,this.imports[i].noBlock?-1:(0,s.twrEventQueueReceive).registerEvent(),this.interfaceName);return r}}class a{static libInstances=[];static libInterfaceInstances=[];static register(e){if(void 0===e.imports)throw Error("twrLibrary derived class is missing imports.");if(void 0===e.libSourcePath)throw Error("twrLibrary derived class is missing libSourcePath.");a.libInstances.push(e);let t=a.libInstances.length-1;if(e.interfaceName){let t=this.getLibraryInstanceByInterfaceName(e.interfaceName);if(void 0===t)a.libInterfaceInstances.push(e);else{let r=a.libInterfaceInstances[t];for(let t=0;t<a.libInterfaceInstances.length;t++)if(a.libInterfaceInstances[t].interfaceName===e.interfaceName&&!function(e,t){let r=Object.keys(e),s=Object.keys(t);for(let s=0;s<r.length;s++){let i=r[s];if(t[i]&&!c(e[i],t[i]))return!1}for(let r=0;r<s.length;r++){let i=s[r];if(e[i]&&!c(e[i],t[i]))return!1}return!0}(a.libInterfaceInstances[t].imports,e.imports))throw Error(`interface definitions (imports) ${e.interfaceName} are not compatible between class ${e.libSourcePath} and ${r.libSourcePath}`);Object.keys(e.imports).length>Object.keys(r.imports).length&&(a.libInterfaceInstances[t]=e)}}else{if(this.getLibraryInstanceByClass(e.libSourcePath))throw Error("A second twrLibrary instance was registered but interfaceName===undefined");a.libInterfaceInstances.push(e)}return t}static getLibraryInstance(e){if(e<0||e>=a.libInstances.length)throw Error("Invalid console ID: "+e);return a.libInstances[e]}static getLibraryInstanceByInterfaceName(e){for(let t=0;t<a.libInterfaceInstances.length;t++)if(a.libInterfaceInstances[t].interfaceName===e)return t}static getLibraryInstanceByClass(e){for(let t=0;t<a.libInterfaceInstances.length;t++)if(a.libInstances[t].libSourcePath===e)return a.libInstances}static getLibraryInstanceID(e){for(let t=0;t<a.libInstances.length;t++)if(a.libInstances[t]==e)return t;throw Error("libInstance not in registry")}}class l{static libProxyInstances=[];static registerProxy(e){return l.libProxyInstances[e.id]=e,e.id}static getLibraryInstanceProxy(e){if(e<0||e>=l.libProxyInstances.length)throw Error("Invalid console ID: "+e);return l.libProxyInstances[e]}static getLibraryInstanceID(e){for(let t=0;t<l.libProxyInstances.length;t++)if(l.libProxyInstances[t]==e)return t;throw Error("libProxyInstance not in registry")}}function c(e,t){let r=Object.keys(e),s=Object.keys(t);return r.length===s.length&&r.every(r=>e[r]===t[r])}}),o("6QEzV",function(t,r){e(t.exports,"twrEventQueueSend",()=>o),e(t.exports,"twrEventQueueReceive",()=>n);var s=i("dRr3I");class o{circBuffer=new s.twrSharedCircularBuffer;postEvent(e,...t){this.circBuffer.writeArray([1749422294,e,t.length,...t])}postMalloc(e,t){this.circBuffer.writeArray([1368691589,e,t])}}class n{circBuffer;pendingEventIDs;pendingEventArgs;ownerMod;static unqiueInt=1;static onEventCallbacks=[];constructor(e,t){this.circBuffer=new s.twrSharedCircularBuffer(t),this.pendingEventIDs=[],this.pendingEventArgs=[],this.ownerMod=e}readEventRemainder(){let e=this.circBuffer.read();if(void 0===e)throw Error("internal error");let t=this.circBuffer.read();if(void 0===t)throw Error("internal error");let r=[];for(let e=0;e<t;e++){let e=this.circBuffer.read();if(void 0===e)throw Error("internal error");r.push(e)}if(!(e in n.onEventCallbacks))throw Error("internal error");this.pendingEventIDs.push(e),this.pendingEventArgs.push(r)}readMallocRemainder(){let e=this.circBuffer.read();if(void 0===e)throw Error("internal error");let t=this.circBuffer.read();if(void 0===t)throw Error("internal error");postMessage(["twrWasmModule",e,"callCOkay",this.ownerMod.wasmMem.malloc(t)])}readCommandRemainder(e){if(1749422294===e)this.readEventRemainder();else if(1368691589===e)this.readMallocRemainder();else throw Error("internal error -- eventMarker or mallocMarker expected but not found")}readCommand(){let e=this.circBuffer.read();this.readCommandRemainder(e)}readWaitCommand(){let e=this.circBuffer.readWait();this.readCommandRemainder(e)}findEvent(e){if(void 0===e)return[this.pendingEventIDs.shift(),this.pendingEventArgs.shift(),0];let t=this.pendingEventIDs.indexOf(e);return -1!=t?[this.pendingEventIDs.splice(t,1)[0],this.pendingEventArgs.splice(t,1)[0],t]:[void 0,void 0,void 0]}waitEvent(e){for(;;){for(;!this.circBuffer.isEmpty();)this.readCommand();let[t,r,s]=this.findEvent(e);if(t&&r)return[t,r];this.readWaitCommand()}}doCallbacks(e){let t=e||this.pendingEventIDs.length;console.log("end",t,e,this.pendingEventIDs.length);for(let e=0;e<t;e++){let t=this.pendingEventIDs[e],r=this.pendingEventArgs[e],s=n.onEventCallbacks[t];s&&(s(t,...r),this.pendingEventIDs.splice(e,1),this.pendingEventArgs.splice(e,1))}}processIncomingCommands(){for(;!this.circBuffer.isEmpty();)this.readCommand();this.doCallbacks()}static registerCallback(e,t){if(!t)throw Error("registerCallback called with a function name that is not exported from the module");return this.onEventCallbacks[++this.unqiueInt]=t,this.unqiueInt}static registerEvent(){return this.onEventCallbacks[++this.unqiueInt]=void 0,this.unqiueInt}}}),o("dRr3I",function(t,r){e(t.exports,"twrSharedCircularBuffer",()=>s);class s{saBuffer;f64Array;i32Array;constructor(e){if("undefined"!=typeof window&&!crossOriginIsolated&&"file:"!==window.location.protocol)throw Error("twrSharedCircularBuffer constructor, crossOriginIsolated="+crossOriginIsolated+". See SharedArrayBuffer docs.");e?this.saBuffer=e:this.saBuffer=new SharedArrayBuffer(2056),this.f64Array=new Float64Array(this.saBuffer,8),this.i32Array=new Int32Array(this.saBuffer,0,2),this.i32Array[0]=0,this.i32Array[1]=0}silentWrite(e){let t=this.i32Array[1];this.f64Array[t]=e,256==++t&&(t=0),this.i32Array[1]=t}writeArray(e){if(e.length>0){for(let t=0;t<e.length;t++)this.silentWrite(e[t]);Atomics.notify(this.i32Array,1)}}write(e){this.silentWrite(e),Atomics.notify(this.i32Array,1)}read(){if(!this.isEmpty()){let e=this.i32Array[0],t=this.f64Array[e];return 256==++e&&(e=0),this.i32Array[0]=e,t}}readWait(){let e=this.read();if(void 0!==e)return e;let t=this.i32Array[0];if(Atomics.wait(this.i32Array,1,t),void 0===(e=this.read()))throw Error("internal error");return e}isEmpty(){return this.i32Array[0]==this.i32Array[1]}}}),o("7KBfz",function(t,r){e(t.exports,"twrWasmCall",()=>s),e(t.exports,"twrWasmModuleCallAsync",()=>i);class s{exports;mem;constructor(e,t){if(!t)throw Error("WebAssembly.Exports undefined");this.exports=t,this.mem=e}callCImpl(e,t=[]){if(!this.exports[e])throw Error("callC: function '"+e+"' not in export table.  Use --export wasm-ld flag.");return(0,this.exports[e])(...t)}callC(e){let t=this.preCallC(e),r=this.callCImpl(e[0],t);return this.postCallC(t,e),r}preCallC(e){if(e.constructor!==Array)throw Error("callC: params must be array, first arg is function name");if(0==e.length)throw Error("callC: missing function name");let t=[],r=0;for(let s=1;s<e.length;s++){let i=e[s];switch(typeof i){case"number":case"bigint":t[r++]=i;break;case"string":t[r++]=this.mem.putString(i);break;case"object":if(i instanceof URL)throw Error("URL arg in callC is no longer supported directly.  use module.fetchAndPutURL");if(i instanceof ArrayBuffer){let e=this.mem.putArrayBuffer(i);t[r++]=e;break}default:throw Error("callC: invalid object type passed in")}}return t}postCallC(e,t){let r=0;for(let s=1;s<t.length;s++){let i=t[s];switch(typeof i){case"number":case"bigint":r++;break;case"string":this.callCImpl("free",[e[r]]),r++;break;case"object":if(i instanceof URL)throw Error("internal error");if(i instanceof ArrayBuffer){let t=new Uint8Array(i),s=e[r];for(let e=0;e<t.length;e++)t[e]=this.mem.mem8[s+e];this.callCImpl("free",[s]),r++;break}throw Error("postCallC: internal error A");default:throw Error("postCallC: internal error B")}}return e}}class i{mem;callCImpl;constructor(e,t){this.mem=e,this.callCImpl=t}async preCallC(e){if(e.constructor!==Array)throw Error("callC: params must be array, first arg is function name");if(0==e.length)throw Error("callC: missing function name");let t=[],r=0;for(let s=1;s<e.length;s++){let i=e[s];switch(typeof i){case"number":case"bigint":t[r++]=i;break;case"string":t[r++]=await this.mem.putString(i);break;case"object":if(i instanceof URL)throw Error("URL arg in callC is no longer supported directly.  use module.fetchAndPutURL");if(i instanceof ArrayBuffer){let e=await this.mem.putArrayBuffer(i);t[r++]=e;break}default:throw Error("callC: invalid object type passed in")}}return t}async postCallC(e,t){let r=0;for(let s=1;s<t.length;s++){let i=t[s];switch(typeof i){case"number":case"bigint":r++;break;case"string":await this.callCImpl("free",[e[r]]),r++;break;case"object":if(i instanceof URL)throw Error("internal error");if(i instanceof ArrayBuffer){let t=new Uint8Array(i),s=e[r];for(let e=0;e<t.length;e++)t[e]=this.mem.mem8[s+e];await this.callCImpl("free",[s]),r++;break}throw Error("postCallC: internal error A");default:throw Error("postCallC: internal error B")}}return e}}}),o("5baAq",function(t,r){e(t.exports,"twrWasmModule",()=>h);var s=i("eZP3w"),o=i("4Jz48"),n=i("9lAov"),a=i("jxXdl"),l=i("6QEzV"),c=i("kwtqA");class h extends a.twrWasmBase{io;ioNamesToID;isTwrWasmModuleAsync=!1;divLog;log;memory;mem8;mem32;memD;stringToU8;copyString;getLong;setLong;getDouble;setDouble;getShort;getString;getU8Arr;getU32Arr;malloc;free;putString;putU8;putArrayBuffer;constructor(e={}){super(),[this.io,this.ioNamesToID]=(0,s.parseModOptions)(e),this.log=(0,o.logToCon).bind(void 0,this.io.stdio),this.divLog=this.log}async loadWasm(e){await (0,c.twrLibBuiltIns)();let t={};for(let e=0;e<n.twrLibraryInstanceRegistry.libInterfaceInstances.length;e++){let r=n.twrLibraryInstanceRegistry.libInterfaceInstances[e];t={...t,...r.getImports(this)}}t={...t,twrConGetIDFromName:e=>{let t=this.wasmMem.getString(e);return this.ioNamesToID[t]||-1}},await super.loadWasm(e,t),this.wasmMem.memory.buffer instanceof ArrayBuffer||console.log("twrWasmModule does not require shared Memory. Okay to remove wasm-ld --shared-memory --no-check-features"),this.memory=this.wasmMem.memory,this.mem8=this.wasmMem.mem8,this.mem32=this.wasmMem.mem32,this.memD=this.wasmMem.memD,this.malloc=this.wasmMem.malloc,this.free=this.wasmMem.free,this.stringToU8=this.wasmMem.stringToU8,this.copyString=this.wasmMem.copyString,this.getLong=this.wasmMem.getLong,this.setLong=this.wasmMem.setLong,this.getDouble=this.wasmMem.getDouble,this.setDouble=this.wasmMem.setDouble,this.getShort=this.wasmMem.getShort,this.getString=this.wasmMem.getString,this.getU8Arr=this.wasmMem.getU8Arr,this.getU32Arr=this.wasmMem.getU32Arr,this.putString=this.wasmMem.putString,this.putU8=this.wasmMem.putU8,this.putArrayBuffer=this.wasmMem.putArrayBuffer,(0,this.exports.twr_wasm_init)(this.ioNamesToID.stdio,this.ioNamesToID.stderr,void 0==this.ioNamesToID.std2d?-1:this.ioNamesToID.std2d,this.wasmMem.mem8.length)}async fetchAndPutURL(e){if(!("object"==typeof e&&e instanceof URL))throw Error("fetchAndPutURL param must be URL");try{let t=await fetch(e),r=await t.arrayBuffer(),s=new Uint8Array(r);return[this.wasmMem.putU8(s),s.length]}catch(t){throw console.log("fetchAndPutURL Error. URL: "+e+"\n"+t+(t.stack?"\n"+t.stack:"")),t}}postEvent(e,...t){if(!(e in l.twrEventQueueReceive.onEventCallbacks))throw Error("twrWasmModule.postEvent called with invalid eventID: "+e+", params: "+t);let r=l.twrEventQueueReceive.onEventCallbacks[e];if(r)r(e,...t);else throw Error("twrWasmModule.postEvent called with undefined callback.  eventID: "+e+", params: "+t)}peekEvent(e){}}}),o("eZP3w",function(t,r){e(t.exports,"parseModOptions",()=>l);var s=i("8wznr"),o=i("8vcno"),n=i("a7Sa2"),a=i("9kgjF");function l(e={}){let t,r;if("undefined"==typeof document)throw Error("twrWasmModuleJSMain should only be created in JavaScript Main.");if(!(t=e.io?e.io:{}).stdio){let r=document.getElementById("twr_iodiv"),i=document.getElementById("twr_iocanvas");e.stdio?t.stdio=e.stdio:r?t.stdio=new s.twrConsoleDiv(r,{foreColor:e.forecolor,backColor:e.backcolor,fontSize:e.fontsize}):i?t.stdio=new n.twrConsoleTerminal(i,{foreColor:e.forecolor,backColor:e.backcolor,fontSize:e.fontsize,widthInChars:e.windim?.[0],heightInChars:e.windim?.[1]}):(t.stdio=new a.twrConsoleDebug,console.log("Stdio console is not specified.  Using twrConsoleDebug."))}if(t.stderr||(t.stderr=new a.twrConsoleDebug),!t.std2d){if(e.d2dcanvas)t.std2d=e.d2dcanvas;else{let e=document.getElementById("twr_d2dcanvas");e&&(t.std2d=new o.twrConsoleCanvas(e))}}return r={},Object.keys(t).forEach(e=>{r[e]=t[e].id}),[t,r]}}),o("8wznr",function(t,r){e(t.exports,"twrConsoleDiv",()=>a);var s=i("lVt1a"),o=i("4Jz48"),n=i("9lAov");class a extends n.twrLibrary{id;element;CURSOR=String.fromCharCode(9611);cursorOn=!1;lastChar=0;extraBR=!1;cpTranslate;keyBuffer=[];keyWaiting;imports={twrConCharOut:{noBlock:!0},twrConGetProp:{},twrConPutStr:{noBlock:!0},twrConCharIn:{isAsyncFunction:!0,isModuleAsyncOnly:!0},twrConSetFocus:{noBlock:!0}};libSourcePath=new URL("file:///../lib-js/twrcondiv.js").pathname;interfaceName="twrConsole";constructor(e,t){if(super(),this.id=(0,n.twrLibraryInstanceRegistry).register(this),void 0!==e){if(this.element=e,!(e&&e instanceof HTMLDivElement))throw Error("Invalid HTMLDivElement parameter in twrConsoleDiv constructor ");t&&(t.backColor&&(this.element.style.backgroundColor=t.backColor),t.foreColor&&(this.element.style.color=t.foreColor),t.fontSize&&(this.element.style.font=t.fontSize.toString()+"px arial")),this.cpTranslate=new s.twrCodePageToUnicodeCodePoint}}isHtmlEntityAtEnd(e){return/&[^;]+;$/.test(e)}removeHtmlEntityAtEnd(e){return e.replace(/&[^;]+;$/,"")}twrConSetFocus(){if(void 0===this.element)throw Error("undefined HTMLDivElement");this.element.focus()}charOut(e){if(e.length>1)throw Error("charOut takes an empty or single char string");this.twrConCharOut(void 0,e.codePointAt(0)||0,s.codePageUTF32)}twrConCharOut(e,t,r){if(!this.element)throw Error("undefined HTMLDivElement");if(!this.cpTranslate)throw Error("internal error");this.extraBR&&(this.extraBR=!1,this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1)),this.element.innerHTML=this.element.innerHTML.slice(0,-4),this.cursorOn&&(this.element.innerHTML+=this.CURSOR));let s=this.cpTranslate.convert(t,r);if(0!=s){switch(s){case 10:case 13:if(10==t&&13==this.lastChar)break;this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1)),this.element.innerHTML+="<br><br>",this.extraBR=!0,this.cursorOn&&(this.element.innerHTML+=this.CURSOR);let e=this.element.getBoundingClientRect();window.scrollTo(0,e.height+100);break;case 8:this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1)),this.isHtmlEntityAtEnd(this.element.innerHTML)?this.element.innerHTML=this.removeHtmlEntityAtEnd(this.element.innerHTML):this.element.innerHTML=this.element.innerHTML.slice(0,-1),this.cursorOn&&(this.element.innerHTML+=this.CURSOR);break;case 14:this.cursorOn||(this.cursorOn=!0,this.element.innerHTML+=this.CURSOR,this.element.focus());break;case 15:this.cursorOn&&(this.cursorOn=!1,this.element.innerHTML=this.element.innerHTML.slice(0,-1));break;default:this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1));let r=String.fromCodePoint(s);" "==r&&(r="&nbsp;"),this.element.innerHTML+=r,this.cursorOn&&(this.element.innerHTML+=this.CURSOR)}this.lastChar=s}}twrConGetProp(e,t){let r=e.wasmMem.getString(t);return this.getProp(r)}getProp(e){return"type"===e?o.IOTypes.CHARWRITE|o.IOTypes.CHARREAD:(console.log("twrConsoleDiv.getProp passed unknown property name: ",e),0)}keyDown(e){if(this.keyWaiting){let t=(0,o.keyEventToCodePoint)(e);t&&(this.keyWaiting(t),this.keyWaiting=void 0)}else this.keyBuffer.push(e)}async twrConCharIn_async(e){let t;return new Promise(e=>{if(this.keyWaiting)throw Error("internal error");for(;t=this.keyBuffer.shift();){let r=(0,o.keyEventToCodePoint)(t);if(r){e(r);return}}this.keyWaiting=e})}putStr(e){for(let t=0;t<e.length;t++)this.twrConCharOut(void 0,e.codePointAt(t),s.codePageUTF32)}twrConPutStr(e,t,r){this.putStr(e.wasmMem.getString(t,void 0,r))}}}),o("4Jz48",function(t,r){e(t.exports,"IOTypes",()=>s),e(t.exports,"keyEventToCodePoint",()=>i),e(t.exports,"logToCon",()=>o);class s{static CHARREAD=1;static CHARWRITE=2;static ADDRESSABLE_DISPLAY=4;static CANVAS2D=8;static EVENTS=16;constructor(){}}function i(e){if(e.isComposing||e.metaKey||"Control"==e.key||"Alt"==e.key)console.log("keyEventProcess SKIPPED-2: ",e.key,e.code,e.key.codePointAt(0),e);else{if(1==e.key.length)return e.key.codePointAt(0);switch(e.key){case"Backspace":return 8;case"Enter":return 10;case"Escape":return 27;case"Delete":return 127;case"ArrowLeft":return 8592;case"ArrowUp":return 8593;case"ArrowRight":return 8594;case"ArrowDown":return 8595}console.log("keyEventProcess SKIPPED: ",e.key,e.code,e.key.codePointAt(0),e)}}function o(e,...t){for(var r=0;r<t.length;r++)e.putStr(t[r].toString()),e.charOut(" ");e.charOut("\n")}}),o("8vcno",function(t,r){e(t.exports,"twrConsoleCanvas",()=>l);var s,o,n=i("4Jz48"),a=i("9lAov");(s=o||(o={}))[s.D2D_FILLRECT=1]="D2D_FILLRECT",s[s.D2D_FILLCODEPOINT=5]="D2D_FILLCODEPOINT",s[s.D2D_SETLINEWIDTH=10]="D2D_SETLINEWIDTH",s[s.D2D_SETFILLSTYLERGBA=11]="D2D_SETFILLSTYLERGBA",s[s.D2D_SETFONT=12]="D2D_SETFONT",s[s.D2D_BEGINPATH=13]="D2D_BEGINPATH",s[s.D2D_MOVETO=14]="D2D_MOVETO",s[s.D2D_LINETO=15]="D2D_LINETO",s[s.D2D_FILL=16]="D2D_FILL",s[s.D2D_STROKE=17]="D2D_STROKE",s[s.D2D_SETSTROKESTYLERGBA=18]="D2D_SETSTROKESTYLERGBA",s[s.D2D_ARC=19]="D2D_ARC",s[s.D2D_STROKERECT=20]="D2D_STROKERECT",s[s.D2D_FILLTEXT=21]="D2D_FILLTEXT",s[s.D2D_IMAGEDATA=22]="D2D_IMAGEDATA",s[s.D2D_PUTIMAGEDATA=23]="D2D_PUTIMAGEDATA",s[s.D2D_BEZIERTO=24]="D2D_BEZIERTO",s[s.D2D_MEASURETEXT=25]="D2D_MEASURETEXT",s[s.D2D_SAVE=26]="D2D_SAVE",s[s.D2D_RESTORE=27]="D2D_RESTORE",s[s.D2D_CREATERADIALGRADIENT=28]="D2D_CREATERADIALGRADIENT",s[s.D2D_SETCOLORSTOP=29]="D2D_SETCOLORSTOP",s[s.D2D_SETFILLSTYLEGRADIENT=30]="D2D_SETFILLSTYLEGRADIENT",s[s.D2D_RELEASEID=31]="D2D_RELEASEID",s[s.D2D_CREATELINEARGRADIENT=32]="D2D_CREATELINEARGRADIENT",s[s.D2D_SETFILLSTYLE=33]="D2D_SETFILLSTYLE",s[s.D2D_SETSTROKESTYLE=34]="D2D_SETSTROKESTYLE",s[s.D2D_CLOSEPATH=35]="D2D_CLOSEPATH",s[s.D2D_RESET=36]="D2D_RESET",s[s.D2D_CLEARRECT=37]="D2D_CLEARRECT",s[s.D2D_SCALE=38]="D2D_SCALE",s[s.D2D_TRANSLATE=39]="D2D_TRANSLATE",s[s.D2D_ROTATE=40]="D2D_ROTATE",s[s.D2D_GETTRANSFORM=41]="D2D_GETTRANSFORM",s[s.D2D_SETTRANSFORM=42]="D2D_SETTRANSFORM",s[s.D2D_RESETTRANSFORM=43]="D2D_RESETTRANSFORM",s[s.D2D_STROKETEXT=44]="D2D_STROKETEXT",s[s.D2D_ROUNDRECT=45]="D2D_ROUNDRECT",s[s.D2D_ELLIPSE=46]="D2D_ELLIPSE",s[s.D2D_QUADRATICCURVETO=47]="D2D_QUADRATICCURVETO",s[s.D2D_SETLINEDASH=48]="D2D_SETLINEDASH",s[s.D2D_GETLINEDASH=49]="D2D_GETLINEDASH",s[s.D2D_ARCTO=50]="D2D_ARCTO",s[s.D2D_GETLINEDASHLENGTH=51]="D2D_GETLINEDASHLENGTH",s[s.D2D_DRAWIMAGE=52]="D2D_DRAWIMAGE",s[s.D2D_RECT=53]="D2D_RECT",s[s.D2D_TRANSFORM=54]="D2D_TRANSFORM",s[s.D2D_SETLINECAP=55]="D2D_SETLINECAP",s[s.D2D_SETLINEJOIN=56]="D2D_SETLINEJOIN",s[s.D2D_SETLINEDASHOFFSET=57]="D2D_SETLINEDASHOFFSET",s[s.D2D_GETIMAGEDATA=58]="D2D_GETIMAGEDATA",s[s.D2D_IMAGEDATATOC=59]="D2D_IMAGEDATATOC",s[s.D2D_GETCANVASPROPDOUBLE=60]="D2D_GETCANVASPROPDOUBLE",s[s.D2D_GETCANVASPROPSTRING=61]="D2D_GETCANVASPROPSTRING",s[s.D2D_SETCANVASPROPDOUBLE=62]="D2D_SETCANVASPROPDOUBLE",s[s.D2D_SETCANVASPROPSTRING=63]="D2D_SETCANVASPROPSTRING";class l extends a.twrLibrary{id;ctx;element;props;precomputedObjects;imports={twrConGetProp:{},twrConDrawSeq:{},twrConLoadImage:{isModuleAsyncOnly:!0,isAsyncFunction:!0}};libSourcePath=new URL("file:///../lib-js/twrconcanvas.js").pathname;interfaceName="twrConsole";constructor(e){if(super(),this.id=(0,a.twrLibraryInstanceRegistry).register(this),this.precomputedObjects={},!(e&&e instanceof HTMLCanvasElement&&e.getContext))throw Error("Invalid HTMLCanvasElement parameter in twrConsoleCanvas constructor ");this.element=e;let t=e.getContext("2d");if(!t)throw Error("Canvas 2D context not found.");this.ctx=t,t.font="16 px Courier New",t.textBaseline="top",this.props={canvasHeight:e.height,canvasWidth:e.width,type:n.IOTypes.CANVAS2D}}getProp(e){return this.props[e]}twrConGetProp(e,t){let r=e.wasmMem.getString(t);return this.getProp(r)}twrConLoadImage_async(e,t,r){return new Promise(s=>{let i=e.wasmMem.getString(t);r in this.precomputedObjects&&console.log("warning: D2D_LOADIMAGE ID already exists.");let o=new Image;o.onload=()=>{s(1)},o.onerror=()=>{console.log("Warning: D2D_LOADIMAGE: failed to load image "+i),s(1)},o.src=i,this.precomputedObjects[r]=o})}twrConDrawSeq(e,t){let r;if(!this.ctx)return;let s=e.wasmMem,i=s.getLong(t),n=s.getLong(t+4),a=i+16;for(;;){let t=s.getLong(i+4);switch(t){case o.D2D_FILLRECT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24);this.ctx.fillRect(e,t,r,i)}break;case o.D2D_STROKERECT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24);this.ctx.strokeRect(e,t,r,i)}break;case o.D2D_FILLCODEPOINT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=String.fromCodePoint(s.getLong(a+16));this.ctx.fillText(r,e,t)}break;case o.D2D_FILLTEXT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getLong(a+20),i=s.getLong(a+16),o=s.getString(i,void 0,r);this.ctx.fillText(o,e,t)}break;case o.D2D_MEASURETEXT:{let e=s.getLong(a+8),t=s.getString(s.getLong(a),void 0,e),r=s.getLong(a+4),i=this.ctx.measureText(t);s.setDouble(r+0,i.actualBoundingBoxAscent),s.setDouble(r+8,i.actualBoundingBoxDescent),s.setDouble(r+16,i.actualBoundingBoxLeft),s.setDouble(r+24,i.actualBoundingBoxRight),s.setDouble(r+32,i.fontBoundingBoxAscent),s.setDouble(r+40,i.fontBoundingBoxDescent),s.setDouble(r+48,i.width)}break;case o.D2D_SETFONT:{let e=s.getLong(a),t=s.getString(e);this.ctx.font=t}break;case o.D2D_SETFILLSTYLERGBA:{let e="#"+("00000000"+s.getLong(a).toString(16)).slice(-8);this.ctx.fillStyle=e}break;case o.D2D_SETSTROKESTYLERGBA:{let e="#"+("00000000"+s.getLong(a).toString(16)).slice(-8);this.ctx.strokeStyle=e}break;case o.D2D_SETFILLSTYLE:{let e=s.getLong(a),t=s.getString(e);this.ctx.fillStyle=t}break;case o.D2D_SETSTROKESTYLE:{let e=s.getLong(a),t=s.getString(e);this.ctx.strokeStyle=t}break;case o.D2D_SETLINEWIDTH:{let e=s.getDouble(a);this.ctx.lineWidth=e}break;case o.D2D_MOVETO:{let e=s.getDouble(a),t=s.getDouble(a+8);this.ctx.moveTo(e,t)}break;case o.D2D_LINETO:{let e=s.getDouble(a),t=s.getDouble(a+8);this.ctx.lineTo(e,t)}break;case o.D2D_BEZIERTO:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32),n=s.getDouble(a+40);this.ctx.bezierCurveTo(e,t,r,i,o,n)}break;case o.D2D_BEGINPATH:this.ctx.beginPath();break;case o.D2D_FILL:this.ctx.fill();break;case o.D2D_SAVE:this.ctx.save();break;case o.D2D_RESTORE:this.ctx.restore();break;case o.D2D_STROKE:this.ctx.stroke();break;case o.D2D_ARC:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32),n=0!=s.getLong(a+40);this.ctx.arc(e,t,r,i,o,n)}break;case o.D2D_IMAGEDATA:{let t=s.getLong(a),r=s.getLong(a+4),i=s.getLong(a+8),o=s.getLong(a+12),n=s.getLong(a+16);if(n in this.precomputedObjects&&console.log("warning: D2D_IMAGEDATA ID already exists."),e.isTwrWasmModuleAsync)this.precomputedObjects[n]={mem8:new Uint8Array(s.memory.buffer,t,r),width:i,height:o};else{let e=new Uint8ClampedArray(s.memory.buffer,t,r);this.precomputedObjects[n]=new ImageData(e,i,o)}}break;case o.D2D_CREATERADIALGRADIENT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32),n=s.getDouble(a+40),l=s.getLong(a+48),c=this.ctx.createRadialGradient(e,t,r,i,o,n);l in this.precomputedObjects&&console.log("warning: D2D_CREATERADIALGRADIENT ID already exists."),this.precomputedObjects[l]=c}break;case o.D2D_CREATELINEARGRADIENT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getLong(a+32),n=this.ctx.createLinearGradient(e,t,r,i);o in this.precomputedObjects&&console.log("warning: D2D_CREATELINEARGRADIENT ID already exists."),this.precomputedObjects[o]=n}break;case o.D2D_SETCOLORSTOP:{let e=s.getLong(a),t=s.getLong(a+4),r=s.getLong(a+8),i=s.getString(r);if(!(e in this.precomputedObjects))throw Error("D2D_SETCOLORSTOP with invalid ID: "+e);this.precomputedObjects[e].addColorStop(t,i)}break;case o.D2D_SETFILLSTYLEGRADIENT:{let e=s.getLong(a);if(!(e in this.precomputedObjects))throw Error("D2D_SETFILLSTYLEGRADIENT with invalid ID: "+e);let t=this.precomputedObjects[e];this.ctx.fillStyle=t}break;case o.D2D_RELEASEID:{let e=s.getLong(a);this.precomputedObjects[e]?delete this.precomputedObjects[e]:console.log("warning: D2D_RELEASEID with undefined ID ",e)}break;case o.D2D_PUTIMAGEDATA:{let t;let r=s.getLong(a),i=s.getLong(a+4),o=s.getLong(a+8),n=s.getLong(a+12),l=s.getLong(a+16),c=s.getLong(a+20),h=s.getLong(a+24);if(!(r in this.precomputedObjects))throw Error("D2D_PUTIMAGEDATA with invalid ID: "+r);if(e.isTwrWasmModuleAsync){let e=this.precomputedObjects[r];t=new ImageData(Uint8ClampedArray.from(e.mem8),e.width,e.height)}else t=this.precomputedObjects[r];0==c&&0==h?this.ctx.putImageData(t,i,o):this.ctx.putImageData(t,i,o,n,l,c,h)}break;case o.D2D_CLOSEPATH:this.ctx.closePath();break;case o.D2D_RESET:this.ctx.reset();break;case o.D2D_CLEARRECT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24);this.ctx.clearRect(e,t,r,i)}break;case o.D2D_SCALE:{let e=s.getDouble(a),t=s.getDouble(a+8);this.ctx.scale(e,t)}break;case o.D2D_TRANSLATE:{let e=s.getDouble(a),t=s.getDouble(a+8);this.ctx.translate(e,t)}break;case o.D2D_ROTATE:{let e=s.getDouble(a);this.ctx.rotate(e)}break;case o.D2D_GETTRANSFORM:{let e=s.getLong(a),t=this.ctx.getTransform();s.setDouble(e+0,t.a),s.setDouble(e+8,t.b),s.setDouble(e+16,t.c),s.setDouble(e+24,t.d),s.setDouble(e+32,t.e),s.setDouble(e+40,t.f)}break;case o.D2D_SETTRANSFORM:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32),n=s.getDouble(a+40);this.ctx.setTransform(e,t,r,i,o,n)}break;case o.D2D_RESETTRANSFORM:this.ctx.resetTransform();break;case o.D2D_STROKETEXT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getLong(a+20),i=s.getLong(a+16),o=s.getString(i,void 0,r);this.ctx.strokeText(o,e,t)}break;case o.D2D_ROUNDRECT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32);this.ctx.roundRect(e,t,r,i,o)}break;case o.D2D_ELLIPSE:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32),n=s.getDouble(a+40),l=s.getDouble(a+48),c=0!=s.getLong(a+56);this.ctx.ellipse(e,t,r,i,o,n,l,c)}break;case o.D2D_QUADRATICCURVETO:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24);this.ctx.quadraticCurveTo(e,t,r,i)}break;case o.D2D_SETLINEDASH:{let e=s.getLong(a),t=s.getLong(a+4),r=[];for(let i=0;i<e;i++)r[i]=s.getDouble(t+8*i);this.ctx.setLineDash(r)}break;case o.D2D_GETLINEDASH:{let e=this.ctx.getLineDash(),t=s.getLong(a),r=s.getLong(a+4),i=a+8;if(s.setLong(i,e.length),e.length>0){for(let i=0;i<Math.min(e.length,t);i++)s.setDouble(r+8*i,e[i]);e.length>t&&console.log("warning: D2D_GETLINEDASH exceeded given max_length, truncating excess")}}break;case o.D2D_ARCTO:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32);this.ctx.arcTo(e,t,r,i,o)}break;case o.D2D_GETLINEDASHLENGTH:s.setLong(a,this.ctx.getLineDash().length);break;case o.D2D_DRAWIMAGE:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32),n=s.getDouble(a+40),l=s.getDouble(a+48),c=s.getDouble(a+56),h=s.getLong(a+64);if(!(h in this.precomputedObjects))throw Error("D2D_DRAWIMAGE with invalid ID: "+h);let u=this.precomputedObjects[h];0==r&&0==i&&0==l&&0==c?this.ctx.drawImage(u,o,n):0==l&&0==c?this.ctx.drawImage(u,e,t,r,i,o,n,r,i):0==r&&0==i?this.ctx.drawImage(u,e,t,u.width,u.height,o,n,l,c):this.ctx.drawImage(u,e,t,r,i,o,n,l,c)}break;case o.D2D_RECT:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24);this.ctx.rect(e,t,r,i)}break;case o.D2D_TRANSFORM:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getDouble(a+32),n=s.getDouble(a+40);this.ctx.transform(e,t,r,i,o,n)}break;case o.D2D_SETLINECAP:{let e=s.getLong(a),t=s.getString(e);this.ctx.lineCap=t}break;case o.D2D_SETLINEJOIN:{let e=s.getLong(a),t=s.getString(e);this.ctx.lineJoin=t}break;case o.D2D_SETLINEDASHOFFSET:{let e=s.getDouble(a);this.ctx.lineDashOffset=e}break;case o.D2D_GETIMAGEDATA:{let e=s.getDouble(a),t=s.getDouble(a+8),r=s.getDouble(a+16),i=s.getDouble(a+24),o=s.getLong(a+32),n=this.ctx.getImageData(e,t,r,i);o in this.precomputedObjects&&console.log("warning: D2D_GETIMAGEDATA ID already exists."),this.precomputedObjects[o]=n}break;case o.D2D_IMAGEDATATOC:{let e=s.getLong(a),t=s.getLong(a+4),r=s.getLong(a+8);if(!(r in this.precomputedObjects))throw Error("D2D_IMAGEDATATOC with invalid ID: "+r);let i=this.precomputedObjects[r],o=i.data.byteLength;o>t&&console.log("Warning: D2D_IMAGEDATATOC was given a buffer smaller than the image size! Extra data is being truncated"),s.mem8.set(i.data.slice(0,Math.min(t,o)),e)}break;case o.D2D_GETCANVASPROPDOUBLE:{let e=s.getLong(a),t=s.getLong(a+4),r=s.getString(t),i=this.ctx[r];if("number"!=typeof i)throw Error("D2D_GETCANVASPROPDOUBLE with property "+r+" expected a number, got "+typeof i+"!");s.setDouble(e,i)}break;case o.D2D_GETCANVASPROPSTRING:{let e=s.getLong(a),t=s.getLong(a+4),r=s.getLong(a+8),i=s.getString(r),o=this.ctx[i];if("string"!=typeof o)throw Error("D2D_GETCANVASPROPSTRING with property "+i+" expected a string, got "+typeof o+"!");let n=s.stringToU8(o);n.byteLength>=t&&console.log("Warning: D2D_GETCANVASPROPSTRING was given a buffer smaller than the return value! The extra data is being truncated!");let l=Math.min(n.byteLength,t-1);s.mem8.set(n.slice(0,l),e),s.mem8[l+e]=0}break;case o.D2D_SETCANVASPROPDOUBLE:{let e=s.getDouble(a),t=s.getLong(a+8),r=s.getString(t),i=this.ctx[r];if("number"!=typeof i)throw Error("D2D_SETCANVASPROPDOUBLE with property "+r+" expected a number, got "+typeof i+"!");this.ctx[r]=e}break;case o.D2D_SETCANVASPROPSTRING:{let e=s.getLong(a),t=s.getLong(a+4),r=s.getString(e),i=s.getString(t),o=this.ctx[i];if("string"!=typeof o)throw Error("D2D_SETCANVASPROPSTRING with property "+i+" expected a string, got "+typeof o+"!");this.ctx[i]=r}break;default:throw Error("unimplemented or unknown Sequence Type in drawSeq: "+t)}if(0==(r=s.getLong(i))){if(i!=n)throw Error("assert type error in twrcanvas, ins!=lastins");break}a=(i=r)+16}}}}),o("a7Sa2",function(t,r){e(t.exports,"twrConsoleTerminal",()=>a);var s=i("lVt1a"),o=i("4Jz48"),n=i("9lAov");class a extends n.twrLibrary{id;element;ctx;props;size;cellWidth;cellHeight;cellW1;cellW2;cellH1;cellH2;cellH3;isCursorVisible;videoMem;foreColorMem;backColorMem;cpTranslate;keyBuffer=[];keyWaiting;imports={twrConCharOut:{noBlock:!0},twrConGetProp:{},twrConPutStr:{noBlock:!0},twrConCharIn:{isAsyncFunction:!0,isModuleAsyncOnly:!0},twrConSetFocus:{noBlock:!0},twrConSetC32:{noBlock:!0},twrConCls:{noBlock:!0},twrConSetRange:{noBlock:!0},twrConSetReset:{noBlock:!0},twrConPoint:{},twrConSetCursor:{noBlock:!0},twrConSetCursorXY:{noBlock:!0},twrConSetColors:{noBlock:!0}};libSourcePath=new URL("file:///../lib-js/twrconterm.js").pathname;interfaceName="twrConsole";constructor(e,t={}){super(),this.id=(0,n.twrLibraryInstanceRegistry).register(this);let{foreColor:r="white",backColor:i="black",fontSize:a=16,widthInChars:l=80,heightInChars:c=25}=t;if(this.element=e,!(e&&e instanceof HTMLCanvasElement&&e.getContext))throw Error("Invalid HTMLCanvasElement parameter in twrConsoleTerminal constructor ");let h=e.getContext("2d");if(!h)throw Error("canvasElement.getContext('2d') failed");h.font=a.toString()+"px Courier New",h.textBaseline="top";let u="          ",m=Math.ceil(h.measureText(u).width/u.length),d=h.measureText("X"),g=Math.ceil(d.fontBoundingBoxAscent+d.fontBoundingBoxDescent);e.width=m*l,e.height=g*c;let w=e.height,f=e.width,p=e.getContext("2d");if(!p)throw Error("canvas 2D context not found in twrCanvas.constructor (2nd time)");this.ctx=p,this.ctx.font=a.toString()+"px Courier New",this.ctx.textBaseline="top",p.fillStyle=i;let D=Number("0x"+p.fillStyle.slice(1));p.fillStyle=r;let C=Number("0x"+p.fillStyle.slice(1)),y=o.IOTypes.CHARWRITE|o.IOTypes.CHARREAD|o.IOTypes.ADDRESSABLE_DISPLAY;if(this.props={type:y,cursorPos:0,foreColorAsRGB:C,backColorAsRGB:D,fontSize:a,widthInChars:l,heightInChars:c,canvasHeight:w,canvasWidth:f,charWidth:m,charHeight:g},this.isCursorVisible=!1,this.size=this.props.widthInChars*this.props.heightInChars,this.videoMem=Array(this.size),this.foreColorMem=Array(this.size),this.backColorMem=Array(this.size),this.cellWidth=this.props.charWidth,this.cellHeight=this.props.charHeight,this.cellWidth<=0)throw Error("invalid cellWidth");if(this.cellHeight<=0)throw Error("invalid cellHeight");this.cellW1=Math.floor(this.cellWidth/2),this.cellW2=this.cellWidth-this.cellW1,this.cellH1=Math.floor(this.cellHeight/3),this.cellH2=this.cellH1,this.cellH3=this.cellHeight-this.cellH1-this.cellH2,this.twrConCls(),this.cpTranslate=new s.twrCodePageToUnicodeCodePoint}getProp(e){return this.props[e]}twrConGetProp(e,t){let r=e.wasmMem.getString(t);return this.getProp(r)}keyDown(e){if(this.keyWaiting){let t=(0,o.keyEventToCodePoint)(e);t&&(this.keyWaiting(t),this.keyWaiting=void 0)}else this.keyBuffer.push(e)}RGB_TO_RGBA(e){return e<<8|255}eraseLine(){for(let e=this.props.cursorPos;e<Math.floor(this.props.cursorPos/this.props.widthInChars)*this.props.widthInChars+this.props.widthInChars;e++)this.setC32(e," ")}twrConCharOut(e,t,r){let s=this.cpTranslate.convert(t,r);0!==s&&this.charOut(String.fromCodePoint(s))}charOut(e){if(e.length>1)throw Error("charOut takes an empty or single char string");if("\n"===e)this.isCursorVisible&&this.setC32(this.props.cursorPos," "),this.props.cursorPos=Math.floor(this.props.cursorPos/this.props.widthInChars),this.props.cursorPos=this.props.cursorPos*this.props.widthInChars,this.props.cursorPos=this.props.cursorPos+this.props.widthInChars,this.props.cursorPos<this.size&&this.eraseLine();else if("\b"===e)this.props.cursorPos>0&&(this.isCursorVisible&&this.setC32(this.props.cursorPos," "),this.props.cursorPos--,this.setC32(this.props.cursorPos," "));else if("\x0e"===e)this.isCursorVisible=!0;else if("\x0f"===e)this.setC32(this.props.cursorPos," "),this.isCursorVisible=!1;else if("\x18"===e)this.props.cursorPos>0&&this.props.cursorPos--;else if("\x19"===e)this.props.cursorPos<this.size-1&&this.props.cursorPos++;else if("\x1a"===e)this.props.cursorPos<this.props.widthInChars*(this.props.heightInChars-1)&&(this.props.cursorPos+=this.props.widthInChars);else if("\x1b"===e)this.props.cursorPos>=this.props.widthInChars&&(this.props.cursorPos-=this.props.widthInChars);else if("\x1c"===e)this.props.cursorPos=0;else if("\x1d"===e)this.props.cursorPos=this.props.cursorPos/this.props.widthInChars*this.props.widthInChars;else if("\x1e"===e)this.eraseLine();else if("\x1f"===e)for(let e=this.props.cursorPos;e<this.size;e++)this.setC32(e," ");else this.setC32(this.props.cursorPos,e),this.props.cursorPos++;if(this.props.cursorPos==this.size){this.props.cursorPos=this.props.widthInChars*(this.props.heightInChars-1);for(let e=0;e<this.props.widthInChars*(this.props.heightInChars-1);e++)this.videoMem[e]=this.videoMem[e+this.props.widthInChars],this.backColorMem[e]=this.backColorMem[e+this.props.widthInChars],this.foreColorMem[e]=this.foreColorMem[e+this.props.widthInChars];for(let e=0;e<this.props.widthInChars;e++)this.videoMem[this.size-e-1]=32,this.backColorMem[this.size-e-1]=this.props.backColorAsRGB,this.foreColorMem[this.size-e-1]=this.props.foreColorAsRGB;this.drawRange(0,this.size-1)}if(this.isCursorVisible&&this.setC32(this.props.cursorPos,String.fromCodePoint(9611)),this.props.cursorPos>=this.size)throw Error("internal error: this.props.cursorPos >= this.size")}putStr(e){for(let t=0;t<e.length;t++)this.twrConCharOut(void 0,e.codePointAt(t)||0,s.codePageUTF32)}twrConPutStr(e,t,r){let i=e.wasmMem.getString(t,void 0,r);for(let t=0;t<i.length;t++)this.twrConCharOut(e,i.codePointAt(t)||0,s.codePageUTF32)}setC32(e,t){if(t.length>1)throw Error("setC32 takes an empty or single char string");this.twrConSetC32(void 0,e,t.codePointAt(0)||0)}twrConSetC32(e,t,r){if(!(t>=0&&t<this.size))throw Error("Invalid location passed to setC32");this.videoMem[t]=r,this.backColorMem[t]=this.props.backColorAsRGB,this.foreColorMem[t]=this.props.foreColorAsRGB;let s=t-1;s<0&&(s=0);let i=t+1;i>=this.size&&(i=this.size-1),this.drawRange(s,i);let o=s,n=i;s-=this.props.widthInChars,i-=this.props.widthInChars,s<0&&(s=0),i<0&&(i=0),this.drawRange(s,i),s=o+this.props.widthInChars,i=n+this.props.widthInChars,s>=this.size&&(s=this.size-1),i>=this.size&&(i=this.size-1),this.drawRange(s,i)}twrConCls(){for(let e=0;e<this.size;e++)this.videoMem[e]=32,this.backColorMem[e]=this.props.backColorAsRGB,this.foreColorMem[e]=this.props.foreColorAsRGB;this.props.cursorPos=0,this.isCursorVisible=!1,this.drawRange(0,this.size-1)}setFillStyleRGB(e){let t=`#${e.toString(16).padStart(6,"0")}`;this.ctx.fillStyle=t}drawTrs80Graphic(e,t,r,s){let i,o;i=e%this.props.widthInChars*this.cellWidth,o=Math.floor(e/this.props.widthInChars)*this.cellHeight,this.setFillStyleRGB(s),this.ctx.fillRect(i,o,this.cellWidth,this.cellHeight),32!=t&&(this.setFillStyleRGB(r),1&t&&this.ctx.fillRect(i,o,this.cellW1,this.cellH1),o+=this.cellH1,4&t&&this.ctx.fillRect(i,o,this.cellW1,this.cellH2),o+=this.cellH2,16&t&&this.ctx.fillRect(i,o,this.cellW1,this.cellH3),i+=this.cellW1,32&t&&this.ctx.fillRect(i,o,this.cellW2,this.cellH3),o-=this.cellH2,8&t&&this.ctx.fillRect(i,o,this.cellW2,this.cellH2),o-=this.cellH1,2&t&&this.ctx.fillRect(i,o,this.cellW2,this.cellH1))}drawCell(e,t,r,s){if((65280&t)==57344||32==t)this.drawTrs80Graphic(e,63&t,r,s);else{let i,o;if(i=e%this.props.widthInChars*this.cellWidth,o=Math.floor(e/this.props.widthInChars)*this.cellHeight,this.setFillStyleRGB(s),this.ctx.fillRect(i,o,this.cellWidth,this.cellHeight),32!=t){this.setFillStyleRGB(r);let e=String.fromCodePoint(t);this.ctx.fillText(e,i,o)}}}setRangeJS(e,t){let r=0;for(let s=e;s<e+t.length;s++)this.videoMem[s]=t[r++];this.drawRange(e,e+t.length-1)}twrConSetRange(e,t,r,s){let i=[];for(let t=r;t<r+s;t++)i.push(e.wasmMem.getLong(t));this.setRangeJS(r,i)}drawRange(e,t){for(let r=e;r<=t;r++)this.drawCell(r,this.videoMem[r],this.foreColorMem[r],this.backColorMem[r])}twrConSetReset(e,t,r,s){let i=Math.floor(t/2)+this.props.widthInChars*Math.floor(r/3),o=t%2,n=r%3;if(t<0||t>2*this.props.widthInChars)throw Error("setReset: invalid x value");if(r<0||r>3*this.props.heightInChars)throw Error("setReset: invalid y value");(65280&this.videoMem[i])!=57344&&(this.videoMem[i]=57344,this.backColorMem[i]=this.props.backColorAsRGB,this.foreColorMem[i]=this.props.foreColorAsRGB),s?this.videoMem[i]|=1<<2*n+o:this.videoMem[i]&=~(1<<2*n+o),this.drawRange(i,i)}twrConPoint(e,t,r){let s=Math.floor(t/2)+this.props.widthInChars*Math.floor(r/3);if(t<0||t>2*this.props.widthInChars)throw Error("Point: invalid x value");if(r<0||r>3*this.props.heightInChars)throw Error("Point: invalid y value");return(65280&this.videoMem[s])==57344&&!!(this.videoMem[s]&1<<r%3*2+t%2)}twrConSetCursor(e,t){if(t<0||t>=this.size)throw Error("setCursor: invalid location: "+t);this.props.cursorPos=t}twrConSetCursorXY(e,t,r){if(t<0||r<0||this.props.widthInChars*r+t>=this.size)throw Error("setCursorXY: invalid parameter(s)");this.twrConSetCursor(e,this.props.widthInChars*r+t)}twrConSetColors(e,t,r){this.props.foreColorAsRGB=t,this.props.backColorAsRGB=r}async twrConCharIn_async(e){let t;return new Promise(e=>{if(this.keyWaiting)throw Error("internal error");for(;t=this.keyBuffer.shift();){let r=(0,o.keyEventToCodePoint)(t);if(r){e(r);return}}this.keyWaiting=e})}twrConSetFocus(){this.element.focus()}}}),o("9kgjF",function(t,r){e(t.exports,"twrConsoleDebug",()=>a);var s=i("4Jz48"),o=i("lVt1a"),n=i("9lAov");class a extends n.twrLibrary{id;logline="";element=void 0;cpTranslate;imports={twrConCharOut:{noBlock:!0},twrConGetProp:{},twrConPutStr:{noBlock:!0}};libSourcePath=new URL("file:///../lib-js/twrcondebug.js").pathname;interfaceName="twrConsole";constructor(){super(),this.id=(0,n.twrLibraryInstanceRegistry).register(this),this.cpTranslate=new o.twrCodePageToUnicodeCodePoint}charOut(e){if(e.length>1)throw Error("charOut takes an empty string or a single char string");"\n"===e?(console.log(this.logline),this.logline=""):(this.logline=this.logline+e,this.logline.length>=300&&(console.log(this.logline),this.logline=""))}twrConCharOut(e,t,r){let s=this.cpTranslate.convert(t,r);s>0&&this.charOut(String.fromCodePoint(s))}getProp(e){return"type"===e?s.IOTypes.CHARWRITE:(console.log("twrConsoleDebug.getProp passed unknown property name: ",e),0)}twrConGetProp(e,t){let r=e.wasmMem.getString(t);return this.getProp(r)}putStr(e){for(let t=0;t<e.length;t++)this.charOut(e[t])}twrConPutStr(e,t,r){this.putStr(e.wasmMem.getString(t,void 0,r))}}}),o("kwtqA",function(t,r){e(t.exports,"twrLibBuiltIns",()=>u);var s=i("dCETg"),o=i("lVt1a"),n=i("ezn7a"),a=i("8YYID"),l=i("3kGIl"),c=i("7qdpQ");let h=!1;async function u(){h||(new s.default,new o.default,new n.default,new a.default,new l.default,new c.default,h=!0)}}),o("dCETg",function(t,r){e(t.exports,"default",()=>o);var s=i("9lAov");class o extends s.twrLibrary{id;imports={twrSin:{isCommonCode:!0},twrCos:{isCommonCode:!0},twrTan:{isCommonCode:!0},twrACos:{isCommonCode:!0},twrASin:{isCommonCode:!0},twrATan:{isCommonCode:!0},twrATan2:{isCommonCode:!0},twrFAbs:{isCommonCode:!0},twrExp:{isCommonCode:!0},twrFloor:{isCommonCode:!0},twrCeil:{isCommonCode:!0},twrLog:{isCommonCode:!0},twrSqrt:{isCommonCode:!0},twrTrunc:{isCommonCode:!0},twrFMod:{isCommonCode:!0},twrPow:{isCommonCode:!0},twrAtod:{isCommonCode:!0},twrDtoa:{isCommonCode:!0},twrToFixed:{isCommonCode:!0},twrToExponential:{isCommonCode:!0},twrFcvtS:{isCommonCode:!0}};libSourcePath=new URL("file:///../lib-js/twrlibmath.js").pathname;constructor(){super(),this.id=(0,s.twrLibraryInstanceRegistry).register(this)}twrSin(e,t){return Math.sin(t)}twrCos(e,t){return Math.cos(t)}twrTan(e,t){return Math.tan(t)}twrACos(e,t){return Math.acos(t)}twrASin(e,t){return Math.asin(t)}twrATan(e,t){return Math.atan(t)}twrATan2(e,t,r){return Math.atan2(t,r)}twrFAbs(e,t){return Math.abs(t)}twrExp(e,t){return Math.exp(t)}twrFloor(e,t){return Math.floor(t)}twrCeil(e,t){return Math.ceil(t)}twrLog(e,t){return Math.log(t)}twrSqrt(e,t){return Math.sqrt(t)}twrTrunc(e,t){return Math.trunc(t)}twrFMod(e,t,r){return t%r}twrPow(e,t,r){return Math.pow(t,r)}twrAtod(e,...t){return this.atod(e.wasmMem,...t)}twrDtoa(e,...t){this.dtoa(e.wasmMem,...t)}twrToFixed(e,...t){this.toFixed(e.wasmMem,...t)}twrToExponential(e,...t){this.toExponential(e.wasmMem,...t)}twrFcvtS(e,...t){return this.fcvtS(e.wasmMem,...t)}atod(e,t,r){let s=e.getString(t,r),i=s.trimStart().toUpperCase();return"INF"==i||"+INF"==i||"INFINITY"==i||"+INFINITY"==i?Number.POSITIVE_INFINITY:"-INF"==i||"-INFINITY"==i?Number.NEGATIVE_INFINITY:Number.parseFloat(s.replaceAll("D","e").replaceAll("d","e"))}dtoa(e,t,r,s,i){if(-1==i){let i=s.toString();e.copyString(t,r,i)}else{let o=s.toString();o.length>i&&(o=s.toPrecision(i)),e.copyString(t,r,o)}}toFixed(e,t,r,s,i){let o=s.toFixed(i);e.copyString(t,r,o)}toExponential(e,t,r,s,i){let o=s.toExponential(i);e.copyString(t,r,o)}fcvtS(e,t,r,s,i,o,n){let a,l;if(0==t||0==n||0==o||r<1)return 1;let c=0;if(Number.isNaN(s))a="1#QNAN00000000000000000000000000000".slice(0,i+1),l=1;else if(Number.isFinite(s)){if(0==s)a="000000000000000000000000000000000000".slice(0,i),l=0;else{if(s<0&&(c=1,s=Math.abs(s)),i>100||s>1e21||s<1e-99)return e.copyString(t,r,""),e.mem32[o]=0,1;let[n="",h=""]=s.toFixed(i).split(".");"0"==n&&(n=""),n.length>0?(l=n.length,a=n+h):l=(a=h.replace(/^0+/,"")).length-h.length}}else a="1#INF00000000000000000000000000000".slice(0,i+1),l=1;return r-1<a.length?1:(e.copyString(t,r,a),e.setLong(o,l),e.setLong(n,c),0)}}}),o("ezn7a",function(t,r){e(t.exports,"default",()=>o);var s=i("9lAov");class o extends s.twrLibrary{id;imports={twr_timer_single_shot:{},twr_timer_repeat:{},twr_timer_cancel:{},twr_sleep:{isAsyncFunction:!0,isModuleAsyncOnly:!0}};libSourcePath=new URL("file:///../lib-js/twrlibtimer.js").pathname;constructor(){super(),this.id=(0,s.twrLibraryInstanceRegistry).register(this)}twr_timer_single_shot(e,t,r){return setTimeout(()=>{e.postEvent(r)},t)}twr_timer_repeat(e,t,r){return setInterval(()=>{e.postEvent(r)},t)}twr_timer_cancel(e,t){clearInterval(t)}async twr_sleep_async(e,t){return new Promise(e=>{setTimeout(()=>{e()},t)})}}}),o("8YYID",function(t,r){e(t.exports,"default",()=>a);var s,o,n=i("9lAov");(s=o||(o={}))[s.AudioBuffer=0]="AudioBuffer",s[s.HTMLAudioElement=1]="HTMLAudioElement";class a extends n.twrLibrary{id;imports={twrAudioFromFloatPCM:{},twrAudioFrom8bitPCM:{},twrAudioFrom16bitPCM:{},twrAudioFrom32bitPCM:{},twrAudioGetFloatPCM:{isAsyncFunction:!0},twrAudioGet8bitPCM:{isAsyncFunction:!0},twrAudioGet16bitPCM:{isAsyncFunction:!0},twrAudioGet32bitPCM:{isAsyncFunction:!0},twrAudioPlay:{},twrAudioPlayRange:{},twrAudioQueryPlaybackPosition:{},twrAudioLoadSync:{isAsyncFunction:!0,isModuleAsyncOnly:!0},twrAudioLoad:{},twrAudioFreeID:{},twrAudioStopPlayback:{},twrAudioGetMetadata:{},twrAudioPlaySync:{isAsyncFunction:!0,isModuleAsyncOnly:!0},twrAudioRangePlaySync:{isAsyncFunction:!0,isModuleAsyncOnly:!0},twrAudioModifyPlaybackVolume:{},twrAudioModifyPlaybackPan:{},twrAudioModifyPlaybackRate:{},twrAudioPlayFile:{}};nextID=0;nextPlaybackID=0;context=new AudioContext;nodes=[];playbacks=[];libSourcePath=new URL("file:///../lib-js/twrlibaudio.js").pathname;constructor(){super(),this.id=(0,n.twrLibraryInstanceRegistry).register(this)}internalSetupAudioBuffer(e,t,r){let s=this.context.createBuffer(e,r,t),i=this.nextID++;return this.nodes[i]=[o.AudioBuffer,s],[s,i]}twrAudioFromFloatPCM(e,t,r,s,i){let[o,n]=this.internalSetupAudioBuffer(t,r,i);for(let r=0;r<t;r++){let t=o.getChannelData(r),n=s/4+r*i;t.set(e.wasmMem.memF.slice(n,n+i))}return n}twrAudioFrom8bitPCM(e,t,r,s,i){let[o,n]=this.internalSetupAudioBuffer(t,r,i);for(let r=0;r<t;r++){let t=o.getChannelData(r),n=s/1+r*i,a=e.wasmMem.mem8.slice(n,n+i);for(let e=0;e<i;e++)t[e]=a[e]>127?(a[e]-256)/128:a[e]/128}return n}twrAudioFrom16bitPCM(e,t,r,s,i){let[o,n]=this.internalSetupAudioBuffer(t,r,i);for(let r=0;r<t;r++){let t=o.getChannelData(r),n=s/2+r*i,a=e.wasmMem.mem16.slice(n,n+i);for(let e=0;e<2*i;e+=2)t[e]=a[e]>32767?(a[e]-65536)/32768:a[e]/32768}return n}twrAudioFrom32bitPCM(e,t,r,s,i){let[o,n]=this.internalSetupAudioBuffer(t,r,i);for(let r=0;r<t;r++){let t=o.getChannelData(r),n=s/4+r*i,a=e.wasmMem.mem32.slice(n,n+i);for(let e=0;e<i;e++)t[e]=a[e]>2147483647?(a[e]-4294967296)/2147483648:a[e]/2147483648}return n}internalGetAnyPCMPart1(e,t,r,s){if(!(t in this.nodes))throw Error(`twrAudioGetSamples couldn't find node of ID ${t}`);let i=this.nodes[t];if(i[0]!=o.AudioBuffer)throw Error(`twrAudioGetSamples expected a node of type AudioBuffer, got ${o[i[0]]}!`);let n=i[1],a=n.length*n.numberOfChannels;return e.wasmMem.setLong(r,n.length),e.wasmMem.setLong(s,n.numberOfChannels),[n,a]}internalSyncGetAnyPCM(e,t,r,s,i,o){let[n,a]=this.internalGetSamplesPart1(e,t,r,s),l=e.malloc(a*i);return o(e,n,l),l}async internalAsyncGetAnyPCM(e,t,r,s,i,o){let[n,a]=this.internalGetSamplesPart1(e,t,r,s),l=await e.malloc(a*i);return o(e,n,l),l}internalGetSamplesPart1(e,t,r,s){if(!(t in this.nodes))throw Error(`twrAudioGetSamples couldn't find node of ID ${t}`);let i=this.nodes[t];if(i[0]!=o.AudioBuffer)throw Error(`twrAudioGetSamples expected a node of type AudioBuffer, got ${o[i[0]]}!`);let n=i[1],a=n.length*n.numberOfChannels;return e.wasmMem.setLong(r,n.length),e.wasmMem.setLong(s,n.numberOfChannels),[n,a]}internalGetFloatPCMPart2(e,t,r){for(let s=0;s<t.numberOfChannels;s++){let i=t.getChannelData(s),o=r/4+s*t.length;e.wasmMem.memF.set(i.slice(0,t.length),o)}}twrAudioGetFloatPCM(e,t,r,s){return this.internalSyncGetAnyPCM(e,t,r,s,4,this.internalGetFloatPCMPart2)}async twrAudioGetFloatPCM_async(e,t,r,s){return await this.internalAsyncGetAnyPCM(e,t,r,s,4,this.internalGetFloatPCMPart2)}internalGet8bitPCMPart2(e,t,r){for(let s=0;s<t.numberOfChannels;s++){let i=t.getChannelData(s),o=r+s*t.length,n=e.wasmMem.mem8.slice(o,t.length);for(let e=0;e<t.length;e++)n[e]=Math.round(128*i[e])}}twrAudioGet8bitPCM(e,t,r,s){return this.internalSyncGetAnyPCM(e,t,r,s,1,this.internalGet8bitPCMPart2)}async twrAudioGet8bitPCM_async(e,t,r,s){return await this.internalAsyncGetAnyPCM(e,t,r,s,1,this.internalGet8bitPCMPart2)}internalGet16bitPCMPart2(e,t,r){for(let s=0;s<t.numberOfChannels;s++){let i=t.getChannelData(s),o=r/2+s*t.length,n=e.wasmMem.mem16.slice(o,t.length);for(let e=0;e<t.length;e++)n[e]=Math.round(32768*i[e])}}twrAudioGet16bitPCM(e,t,r,s){return this.internalSyncGetAnyPCM(e,t,r,s,2,this.internalGet16bitPCMPart2)}async twrAudioGet16bitPCM_async(e,t,r,s){return await this.internalAsyncGetAnyPCM(e,t,r,s,2,this.internalGet16bitPCMPart2)}internalGet32bitPCMPart2(e,t,r){for(let s=0;s<t.numberOfChannels;s++){let i=t.getChannelData(s),o=r/4+s*t.length,n=e.wasmMem.mem32.slice(o,t.length);for(let e=0;e<t.length;e++)n[e]=Math.round(2147483648*i[e])}}twrAudioGet32bitPCM(e,t,r,s){return this.internalSyncGetAnyPCM(e,t,r,s,4,this.internalGet32bitPCMPart2)}async twrAudioGet21bitPCM_async(e,t,r,s){return await this.internalAsyncGetAnyPCM(e,t,r,s,4,this.internalGet32bitPCMPart2)}twrAudioPlay(e,t,r=1,s=0,i=null){return this.twrAudioPlayRange(e,t,0,null,!1,null,r,s,i)}internalAudioPlayRange(e,t,r,s,i,n,a,l){let c;if(!(t in this.nodes))throw Error(`twrLibAudio twrAudioPlayNode was given a non-existant nodeID (${t})!`);0==n&&(n=null);let h=this.nodes[t],u=this.nextPlaybackID++;if(h[0]===o.AudioBuffer){null==s&&(s=h[1].length);let e=h[1],t=this.context.createBufferSource();t.buffer=e,c=new Promise((e,r)=>{t.onended=()=>{delete this.playbacks[u],e(u)}});let m=r/h[1].sampleRate,d=(s-r)/h[1].sampleRate;t.loop=i,t.loopStart=m,t.loopEnd=s/h[1].sampleRate,t.playbackRate.value=n?n/h[1].sampleRate:1,t.start(0,m,i?void 0:d);let g=this.context.createGain();g.gain.value=a,t.connect(g);let w=this.context.createStereoPanner();w.pan.value=l,g.connect(w),w.connect(this.context.destination),this.playbacks[u]=[o.AudioBuffer,t,new Date().getTime(),h[1].sampleRate,g,w]}else throw Error(`twrAudioPlayNode unknown type! ${h[0]}`);return[c,u]}twrAudioPlayRange(e,t,r,s=null,i=!1,o=null,n=1,a=0,l=null){-1e3==l&&(l=null);let[c,h]=this.internalAudioPlayRange(e,t,r,s,i,o,n,a);return null!=l&&c.then(t=>{e.postEvent(l,t)}),h}async twrAudioPlaySync_async(e,t,r=1,s=0){return this.twrAudioPlayRangeSync_async(e,t,0,null,!1,null,r,s)}async twrAudioPlayRangeSync_async(e,t,r,s=null,i=!1,o=null,n=1,a=0){let[l,c]=this.internalAudioPlayRange(e,t,r,s,i,o,n,a);return await l,c}twrAudioQueryPlaybackPosition(e,t){if(!(t in this.playbacks))return -1;let r=this.playbacks[t];switch(r[0]){case o.AudioBuffer:return new Date().getTime()-r[2];case o.HTMLAudioElement:return r[1].currentTime;default:throw Error(`twrAudioQueryPlaybackPosition unknown type! ${r[0]}`)}}async internalLoadAudio(e,t,r){let s=e.wasmMem.getString(t),i=await fetch(s),n=await this.context.decodeAudioData(await i.arrayBuffer());this.nodes[r]=[o.AudioBuffer,n]}async twrAudioLoadSync_async(e,t){let r=this.nextID++;return await this.internalLoadAudio(e,t,r),r}twrAudioLoad(e,t,r){let s=this.nextID++;return this.internalLoadAudio(e,r,s).then(()=>{e.postEvent(t,s)}),s}twrAudioFreeID(e,t){if(!(t in this.nodes))throw Error(`twrAudioFreeID couldn't find node of ID ${t}`);delete this.nodes[t]}twrAudioGetMetadata(e,t,r){if(!(t in this.nodes))throw Error(`twrAudioGetMetadata couldn't find node of ID ${t}`);let s=this.nodes[t];if(s[0]===o.AudioBuffer)e.wasmMem.setLong(r+0,s[1].length),e.wasmMem.setLong(r+4,s[1].sampleRate),e.wasmMem.setLong(r+8,s[1].numberOfChannels);else throw Error(`twrAudioGetMetadata unknown type! ${s[0]}`)}twrAudioStopPlayback(e,t){if(!(t in this.playbacks)){console.log(`Warning: twrAudioStopPlayback was given an ID that didn't exist (${t})!`);return}let r=this.playbacks[t];switch(r[0]){case o.AudioBuffer:r[1].stop();break;case o.HTMLAudioElement:r[1].loop=!1,r[1].currentTime=Number.MAX_SAFE_INTEGER,delete this.playbacks[t];break;default:throw Error(`twrAudioStopPlayback unknown type! ${r[0]}`)}}twrAudioModifyPlaybackVolume(e,t,r){if(!(t in this.playbacks)){console.log(`Warning: twrAudioModifyPlaybackVolume was given an ID that didn't exist (${t})!`);return}let s=this.playbacks[t];switch((r>1||r<0)&&(console.log(`Warning! twrAudioModifyPlaybackVolume was given a volume (${r}) that wasn't between 0 and 1!`),r=Math.max(Math.min(r,1),0)),s[0]){case o.AudioBuffer:s[4].gain.value=r;break;case o.HTMLAudioElement:s[1].volume=r}}twrAudioModifyPlaybackPan(e,t,r){if(!(t in this.playbacks)){console.log(`Warning: twrAudioModifyPlaybackPan was given an ID that didn't exist (${t})!`);return}let s=this.playbacks[t];switch(s[0]){case o.AudioBuffer:s[5].pan.value=r;break;case o.HTMLAudioElement:throw Error("Can't modify the pan of a playback started by twrAudioPlayFile!")}}twrAudioModifyPlaybackRate(e,t,r){if(!(t in this.playbacks)){console.log(`Warning: twrAudioModifyPlaybackRate was given an ID that didn't exist (${t})!`);return}let s=this.playbacks[t];switch(s[0]){case o.AudioBuffer:{let e=s[1],t=s[3];e.playbackRate.value=r/t}break;case o.HTMLAudioElement:s[1].playbackRate=r}}twrAudioPlayFile(e,t,r=1,s=1,i=!1){let n=this.nextPlaybackID++,a=new Audio(e.wasmMem.getString(t));return a.volume=r,a.loop=i,a.playbackRate=s,a.onended=()=>{delete this.playbacks[n]},a.play(),this.playbacks[n]=[o.HTMLAudioElement,a],n}}}),o("3kGIl",function(t,r){e(t.exports,"default",()=>o);var s=i("9lAov");class o extends s.twrLibrary{id;imports={twrTimeEpoch:{isCommonCode:!0}};libSourcePath=new URL("file:///../lib-js/twrlibdate.js").pathname;constructor(){super(),this.id=(0,s.twrLibraryInstanceRegistry).register(this)}twrTimeEpoch(e){return BigInt(Date.now())}}}),o("7qdpQ",function(t,r){e(t.exports,"default",()=>o);var s=i("9lAov");class o extends s.twrLibrary{id;imports={twrConCharOut:{noBlock:!0},twrConGetProp:{},twrConPutStr:{noBlock:!0},twrConCharIn:{isAsyncFunction:!0,isModuleAsyncOnly:!0},twrConSetFocus:{noBlock:!0},twrConSetC32:{noBlock:!0},twrConCls:{noBlock:!0},twrConSetRange:{noBlock:!0},twrConSetReset:{noBlock:!0},twrConPoint:{},twrConSetCursor:{noBlock:!0},twrConSetCursorXY:{noBlock:!0},twrConSetColors:{noBlock:!0},twrConDrawSeq:{},twrConLoadImage:{isModuleAsyncOnly:!0,isAsyncFunction:!0}};libSourcePath=new URL("file:///../lib-js/twrcondummy.js").pathname;interfaceName="twrConsole";constructor(){super(),this.id=(0,s.twrLibraryInstanceRegistry).register(this)}twrConGetProp(e,t){throw Error("internal error")}keyDown(e){throw Error("internal error")}twrConCharOut(e,t,r){throw Error("internal error")}twrConPutStr(e,t,r){throw Error("internal error")}twrConSetC32(e,t,r){throw Error("internal error")}twrConCls(){throw Error("internal error")}twrConSetRange(e,t,r,s){throw Error("internal error")}setRangeJS(e,t){throw Error("internal error")}twrConSetReset(e,t,r,s){throw Error("internal error")}twrConPoint(e,t,r){throw Error("internal error")}twrConSetCursor(e,t){throw Error("internal error")}twrConSetCursorXY(e,t,r){throw Error("internal error")}twrConSetColors(e,t,r){throw Error("internal error")}async twrConCharIn_async(e){throw Error("internal error")}twrConSetFocus(){throw Error("internal error")}twrConDrawSeq(e,t){throw Error("internal error")}getProp(e){throw Error("internal error")}putStr(e){throw Error("internal error")}charOut(e){throw Error("internal error")}twrConLoadImage_async(e,t,r){throw Error("internal error")}}}),o("U6Thw",function(t,r){e(t.exports,"twrWasmModuleAsync",()=>u);var s=i("4Jz48"),o=i("eZP3w"),n=i("3tyux"),a=i("7KBfz"),l=i("9lAov"),c=i("6QEzV"),h=i("kwtqA");class u{myWorker;loadWasmResolve;loadWasmReject;callCMap;uniqueInt;initLW=!1;io;ioNamesToID;wasmMem;callCInstance;eventQueueSend=new c.twrEventQueueSend;isTwrWasmModuleAsync=!0;divLog;log;memory;exports;mem8;mem32;memD;stringToU8;copyString;getLong;setLong;getDouble;setDouble;getShort;getString;getU8Arr;getU32Arr;malloc;free;putString;putU8;putArrayBuffer;constructor(e){if([this.io,this.ioNamesToID]=(0,o.parseModOptions)(e),this.callCMap=new Map,this.uniqueInt=1,!window.Worker)throw Error("This browser doesn't support web workers.");let t=new URL(i("6WTYx"));this.myWorker=new Worker(t,{type:"module"}),this.myWorker.onerror=e=>{throw console.log("this.myWorker.onerror (undefined message typically means Worker failed to load)"),console.log("event.message: "+e.message),e},this.myWorker.onmessage=this.processMsg.bind(this),this.log=(0,s.logToCon).bind(void 0,this.io.stdio),this.divLog=this.log}async loadWasm(e){if(this.initLW)throw Error("twrWasmModuleAsync::loadWasm can only be called once per instance");return this.initLW=!0,await (0,h.twrLibBuiltIns)(),new Promise((t,r)=>{this.loadWasmResolve=t,this.loadWasmReject=r;let s=[];for(let e=0;e<l.twrLibraryInstanceRegistry.libInterfaceInstances.length;e++)s.push((0,l.twrLibraryInstanceRegistry).libInterfaceInstances[e].getProxyParams());let i={libProxyParams:s,ioNamesToID:this.ioNamesToID,eventQueueBuffer:this.eventQueueSend.circBuffer.saBuffer},o={urlToLoad:new URL(e,document.URL).href,allProxyParams:i};this.myWorker.postMessage(["startup",o])})}postEvent(e,...t){this.eventQueueSend.postEvent(e,...t),this.myWorker.postMessage(["tickleEventLoop"])}async callC(e){let t=await this.callCInstance.preCallC(e),r=await this.callCImpl(e[0],t);return await this.callCInstance.postCallC(t,e),r}async callCImpl(e,t=[]){return new Promise((r,s)=>{this.callCMap.set(++this.uniqueInt,{callCResolve:r,callCReject:s}),this.myWorker.postMessage(["callC",this.uniqueInt,e,t])})}async mallocImpl(e){return new Promise((t,r)=>{this.callCMap.set(++this.uniqueInt,{callCResolve:t,callCReject:r}),this.eventQueueSend.postMalloc(this.uniqueInt,e),this.myWorker.postMessage(["tickleEventLoop"])})}keyDown(e){if(!this.io.stdio)throw Error("internal error - stdio not defined");if(!this.io.stdio.keyDown)throw Error("stdio.keyDown not defined. Console must implemented IConsoleStreamIn.");this.io.stdio.keyDown(e)}keyDownDiv(e){if(this.io.stdio.element&&"twr_iodiv"==this.io.stdio.element.id)this.keyDown(e);else throw Error("keyDownDiv is deprecated, but in any case should only be used with twr_iodiv")}keyDownCanvas(e){if(this.io.stdio.element&&"twr_iocanvas"==this.io.stdio.element.id)this.keyDown(e);else throw Error("keyDownCanvas is deprecated, but in any case should only be used with twr_iocanvas")}async processMsg(e){let t=e.data,[r,s]=t;if("twrWasmModule"===r){let[,,e,...r]=t;switch(e){case"setmemory":if(this.memory=r[0],!this.memory)throw Error("unexpected error - undefined memory");this.wasmMem=new n.twrWasmMemoryAsync(this.memory,this.mallocImpl.bind(this),this.callCImpl.bind(this)),this.callCInstance=new a.twrWasmModuleCallAsync(this.wasmMem,this.callCImpl.bind(this)),this.mem8=this.wasmMem.mem8,this.mem32=this.wasmMem.mem32,this.memD=this.wasmMem.memD,this.stringToU8=this.wasmMem.stringToU8,this.copyString=this.wasmMem.copyString,this.getLong=this.wasmMem.getLong,this.setLong=this.wasmMem.setLong,this.getDouble=this.wasmMem.getDouble,this.setDouble=this.wasmMem.setDouble,this.getShort=this.wasmMem.getShort,this.getString=this.wasmMem.getString,this.getU8Arr=this.wasmMem.getU8Arr,this.getU32Arr=this.wasmMem.getU32Arr,this.malloc=this.wasmMem.malloc,this.free=this.wasmMem.free,this.putString=this.wasmMem.putString,this.putU8=this.wasmMem.putU8,this.putArrayBuffer=this.wasmMem.putArrayBuffer;break;case"startupFail":let[i]=r;if(this.loadWasmReject)this.loadWasmReject(i);else throw Error("twrWasmAsyncModule.processMsg unexpected error (undefined loadWasmReject)");break;case"startupOkay":if(this.loadWasmResolve)this.loadWasmResolve(void 0);else throw Error("twrWasmAsyncModule.processMsg unexpected error (undefined loadWasmResolve)");break;case"callCFail":{let[e]=r,t=this.callCMap.get(s);if(!t)throw Error("internal error");if(this.callCMap.delete(s),t.callCReject)t.callCReject(e);else throw Error("twrWasmAsyncModule.processMsg unexpected error (undefined callCReject)")}break;case"callCOkay":{let[e]=r,t=this.callCMap.get(s);if(!t)throw Error("internal error");if(this.callCMap.delete(s),t.callCResolve)t.callCResolve(e);else throw Error("twrWasmAsyncModule.processMsg unexpected error (undefined callCResolve)");break}default:throw Error("internal error: "+e)}}else if("twrLibrary"===r){let e=(0,l.twrLibraryInstanceRegistry).getLibraryInstance(s);await e.processMessageFromProxy(t,this)}else throw Error("twrWasmAsyncModule - unknown and unexpected msgClass: "+r)}async fetchAndPutURL(e){if(!("object"==typeof e&&e instanceof URL))throw Error("fetchAndPutURL param must be URL");try{let t=await fetch(e),r=await t.arrayBuffer(),s=new Uint8Array(r);return[await this.wasmMem.putU8(s),s.length]}catch(t){throw console.log("fetchAndPutURL Error. URL: "+e+"\n"+t+(t.stack?"\n"+t.stack:"")),t}}}}),o("6WTYx",function(e,t){e.exports=new URL("../twrmodasyncproxy.205483dd.js",import.meta.url).toString()});
//# sourceMappingURL=index.e96d9fe1.js.map
