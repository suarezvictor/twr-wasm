let e;function t(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}var r=globalThis,s={},o={},i=r.parcelRequire8dfc;null==i&&((i=function(e){if(e in s)return s[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return s[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){o[e]=t},r.parcelRequire8dfc=i);var n=i.register;n("jhM3f",function(e,r){t(e.exports,"twrWasmModuleBase",()=>n);var s=i("8k9qF"),o=i("7qrGZ");class n{memory;mem8;mem32;memD;exports;isAsyncProxy=!1;floatUtil;constructor(){this.mem8=new Uint8Array,this.mem32=new Uint32Array,this.memD=new Float64Array,this.floatUtil=new s.twrFloatUtil(this)}async loadWasm(e,t,r){let s;try{s=await fetch(e)}catch(t){throw console.log("loadWasm() failed to fetch: "+e),t}if(!s.ok)throw Error("fetch response error on file '"+e+"'\n"+s.statusText);try{let e=await s.arrayBuffer(),o=await WebAssembly.instantiate(e,{env:t});if(this.exports=o.instance.exports,!this.exports)throw Error("Unexpected error - undefined instance.exports");if(this.memory)throw Error("unexpected error -- this.memory already set");if(this.memory=this.exports.memory,!this.memory)throw Error("Unexpected error - undefined exports.memory");this.mem8=new Uint8Array(this.memory.buffer),this.mem32=new Uint32Array(this.memory.buffer),this.memD=new Float64Array(this.memory.buffer),this.isAsyncProxy?(this.memory.buffer instanceof ArrayBuffer&&console.log("twrWasmModuleAsync requires shared Memory. Add wasm-ld --shared-memory --no-check-features (see docs)"),postMessage(["setmemory",this.memory])):this.memory.buffer instanceof ArrayBuffer||console.log("twrWasmModule does not require shared Memory. Okay to remove wasm-ld --shared-memory --no-check-features"),this.malloc=e=>new Promise(t=>{let r=this.exports.malloc;t(r(e))}),this.init(r)}catch(e){throw console.log("Wasm instantiate error: "+e+(e.stack?"\n"+e.stack:"")),e}}init(e){(0,this.exports.twr_wasm_init)(e.stdio,e.stderr,void 0==e.std2d?-1:e.std2d,this.mem8.length)}async callC(e){let t=await this.preCallC(e),r=await this.callCImpl(e[0],t);return await this.postCallC(t,e),r}async callCImpl(e,t=[]){if(!this.exports)throw Error("this.exports undefined");if(!this.exports[e])throw Error("callC: function '"+e+"' not in export table.  Use --export wasm-ld flag.");return(0,this.exports[e])(...t)}async preCallC(e){if(e.constructor!==Array)throw Error("callC: params must be array, first arg is function name");if(0==e.length)throw Error("callC: missing function name");let t=[],r=0;for(let s=1;s<e.length;s++){let o=e[s];switch(typeof o){case"number":case"bigint":t[r++]=o;break;case"string":t[r++]=await this.putString(o);break;case"object":if(o instanceof URL){let e=await this.fetchAndPutURL(o);t[r++]=e[0],t[r++]=e[1];break}if(o instanceof ArrayBuffer){let e=await this.putArrayBuffer(o);t[r++]=e;break}default:throw Error("callC: invalid object type passed in")}}return t}async postCallC(e,t){let r=0;for(let s=1;s<t.length;s++){let o=t[s];switch(typeof o){case"number":case"bigint":r++;break;case"string":await this.callCImpl("free",[e[r]]),r++;break;case"object":if(o instanceof URL){await this.callCImpl("free",[e[r]]),r+=2;break}if(o instanceof ArrayBuffer){let t=new Uint8Array(o),s=e[r];for(let e=0;e<t.length;e++)t[e]=this.mem8[s+e];await this.callCImpl("free",[s]),r++;break}throw Error("postCallC: internal error A");default:throw Error("postCallC: internal error B")}}return e}stringToU8(e,t=o.codePageUTF8){let r;if(t==o.codePageUTF8)r=new TextEncoder().encode(e);else if(t==o.codePage1252){r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=(0,o.to1252)(e[t])}else if(t==o.codePageASCII){r=new Uint8Array(e.length);for(let t=0;t<e.length;t++){let s=(0,o.toASCII)(e[t]);r[t]=s}}else throw Error("unknown codePage: "+t);return r}copyString(e,t,r,s=o.codePageUTF8){let i;if(t<1)throw Error("copyString buffer_size must have length > 0 (room for terminating 0): "+t);let n=this.stringToU8(r,s);for(i=0;i<n.length&&i<t-1;i++)this.mem8[e+i]=n[i];this.mem8[e+i]=0}async putString(e,t=o.codePageUTF8){let r=this.stringToU8(e,t),s=await this.malloc(r.length+1);return this.mem8.set(r,s),this.mem8[s+r.length]=0,s}async putU8(e){let t=await this.malloc(e.length);return this.mem8.set(e,t),t}async putArrayBuffer(e){let t=new Uint8Array(e);return this.putU8(t)}async fetchAndPutURL(e){if(!("object"==typeof e&&e instanceof URL))throw Error("fetchAndPutURL param must be URL");try{let t=await fetch(e),r=await t.arrayBuffer(),s=new Uint8Array(r);return[await this.putU8(s),s.length]}catch(t){throw console.log("fetchAndPutURL Error. URL: "+e+"\n"+t+(t.stack?"\n"+t.stack:"")),t}}getLong(e){let t=Math.floor(e/4);if(4*t!=e)throw Error("getLong passed non long aligned address");if(t<0||t>=this.mem32.length)throw Error("invalid index passed to getLong: "+e+", this.mem32.length: "+this.mem32.length);return this.mem32[t]}setLong(e,t){let r=Math.floor(e/4);if(4*r!=e)throw Error("setLong passed non long aligned address");if(r<0||r>=this.mem32.length-1)throw Error("invalid index passed to setLong: "+e+", this.mem32.length: "+this.mem32.length);this.mem32[r]=t}getDouble(e){let t=Math.floor(e/8);if(8*t!=e)throw Error("getLong passed non Float64 aligned address");return this.memD[t]}setDouble(e,t){let r=Math.floor(e/8);if(8*r!=e)throw Error("setDouble passed non Float64 aligned address");this.memD[r]=t}getShort(e){if(e<0||e>=this.mem8.length)throw Error("invalid index passed to getShort: "+e);return this.mem8[e]+256*this.mem8[e+1]}getString(e,t,r=o.codePageUTF8){let s;if(e<0||e>=this.mem8.length)throw Error("invalid strIndex passed to getString: "+e);if(t){if(t<0||t+e>this.mem8.length)throw Error("invalid len  passed to getString: "+t)}else{if(-1==(t=this.mem8.indexOf(0,e)))throw Error("string is not null terminated");t-=e}if(r==o.codePageUTF8)s="utf-8";else if(r==o.codePage1252)s="windows-1252";else throw Error("Unsupported codePage: "+r);let i=new TextDecoder(s),n=new Uint8Array(this.mem8.buffer,e,t);if(this.mem8.buffer instanceof ArrayBuffer)return i.decode(n);{let e=new Uint8Array(new ArrayBuffer(t));return e.set(n),i.decode(e)}}getU8Arr(e){if(e<0||e>=this.mem8.length)throw Error("invalid index passed to getU8: "+e);let t=new Uint32Array(this.mem8.slice(e,e+8).buffer),r=t[0],s=t[1];if(s<0||s>=this.mem8.length)throw Error("invalid idx.dataptr passed to getU8");if(r<0||r>this.mem8.length-s)throw Error("invalid idx.size passed to  getU8");return this.mem8.slice(s,s+r)}getU32Arr(e){if(e<0||e>=this.mem8.length)throw Error("invalid index passed to getU32: "+e);let t=new Uint32Array(this.mem8.slice(e,e+8).buffer),r=t[0],s=t[1];if(s<0||s>=this.mem8.length)throw Error("invalid idx.dataptr passed to getU32");if(r<0||r>this.mem8.length-s)throw Error("invalid idx.size passed to  getU32");if(r%4!=0)throw Error("idx.size is not an integer number of 32 bit words");return new Uint32Array(this.mem8.slice(s,s+r).buffer)}}}),n("8k9qF",function(e,r){t(e.exports,"twrFloatUtil",()=>s);class s{mod;constructor(e){this.mod=e}atod(e,t){let r=this.mod.getString(e,t),s=r.trimStart().toUpperCase();return"INF"==s||"+INF"==s||"INFINITY"==s||"+INFINITY"==s?Number.POSITIVE_INFINITY:"-INF"==s||"-INFINITY"==s?Number.NEGATIVE_INFINITY:Number.parseFloat(r.replaceAll("D","e").replaceAll("d","e"))}dtoa(e,t,r,s){if(-1==s){let s=r.toString();this.mod.copyString(e,t,s)}else{let o=r.toString();o.length>s&&(o=r.toPrecision(s)),this.mod.copyString(e,t,o)}}toFixed(e,t,r,s){let o=r.toFixed(s);this.mod.copyString(e,t,o)}toExponential(e,t,r,s){let o=r.toExponential(s);this.mod.copyString(e,t,o)}fcvtS(e,t,r,s,o,i){let n,a;if(0==e||0==i||0==o||t<1)return 1;let l=0;if(Number.isNaN(r))n="1#QNAN00000000000000000000000000000".slice(0,s+1),a=1;else if(Number.isFinite(r)){if(0==r)n="000000000000000000000000000000000000".slice(0,s),a=0;else{if(r<0&&(l=1,r=Math.abs(r)),s>100||r>1e21||r<1e-99)return this.mod.copyString(e,t,""),this.mod.mem32[o]=0,1;let[i="",h=""]=r.toFixed(s).split(".");"0"==i&&(i=""),i.length>0?(a=i.length,n=i+h):a=(n=h.replace(/^0+/,"")).length-h.length}}else n="1#INF00000000000000000000000000000".slice(0,s+1),a=1;return t-1<n.length?1:(this.mod.copyString(e,t,n),this.mod.setLong(o,a),this.mod.setLong(i,l),0)}}}),n("7qrGZ",function(e,r){t(e.exports,"codePageASCII",()=>s),t(e.exports,"codePage1252",()=>o),t(e.exports,"codePageUTF8",()=>i),t(e.exports,"codePageUTF32",()=>n),t(e.exports,"twrCodePageToUnicodeCodePoint",()=>a),t(e.exports,"twrUnicodeCodePointToCodePageImpl",()=>h),t(e.exports,"twrUserLanguageImpl",()=>c),t(e.exports,"twrRegExpTest1252Impl",()=>u),t(e.exports,"to1252",()=>g),t(e.exports,"toASCII",()=>d),t(e.exports,"twrToLower1252Impl",()=>D),t(e.exports,"twrToUpper1252Impl",()=>p),t(e.exports,"twrStrcollImpl",()=>m),t(e.exports,"twrTimeTmLocalImpl",()=>f),t(e.exports,"twrUserLconvImpl",()=>T),t(e.exports,"twrGetDtnamesImpl",()=>b);let s=0,o=1252,i=65001,n=12e3;class a{decoderUTF8=new TextDecoder("utf-8");decoder1252=new TextDecoder("windows-1252");convert(e,t){let r;if(t==i)r=this.decoderUTF8.decode(new Uint8Array([e]),{stream:!0});else if(t==o)r=this.decoder1252.decode(new Uint8Array([e]));else if(t==s)r=e>127?"":String.fromCharCode(e);else if(t==n)r=String.fromCodePoint(e);else throw Error("unsupported CodePage: "+t);return r.codePointAt(0)||0}}let l=new a;function h(e,t,r){return function(e,t,r,s){let o=e.stringToU8(r,s);return e.mem8.set(o,t),o.length}(this,e,String.fromCodePoint(t),r)}function c(){return E(this,navigator.language,s)}function u(e,t){let r=RegExp(this.getString(e),"u"),s=l.decoder1252.decode(new Uint8Array([t]));return r.test(s)?1:0}function g(e){if(8239==e.codePointAt(0))return 32;let t=e.codePointAt(0)||0;switch(t){case 338:return 140;case 339:return 156;case 352:return 138;case 353:return 154;case 376:return 159;case 381:return 142;case 382:return 158;case 402:return 131;case 710:return 136}switch(e.normalize()){case"€":return 128;case"‚":return 130;case"ƒ":return 131;case"„":return 132;case"…":return 133;case"†":return 134;case"‡":return 135;case"ˆ":return 136;case"‰":return 137;case"Š":return 138;case"‹":return 139;case"Œ":return 140;case"Ž":return 142;case"‘":return 145;case"’":return 146;case"“":return 147;case"”":return 148;case"•":return 149;case"–":return 150;case"—":return 151;case"˜":return 152;case"™":return 153;case"š":return 154;case"›":return 155;case"œ":return 156;case"ž":return 158;case"Ÿ":return 159}return t>255&&(console.log("twr-wasm.to1252(): unable to convert: ",e,t),t=0),t}function d(e){if("ƒ"==e)return 102;if(8239==e.codePointAt(0))return 32;let t=e.codePointAt(0)||0;return t>127?63:t}function D(e){let t=l.decoder1252.decode(new Uint8Array([e]));return RegExp("^\\p{Letter}$","u").test(t)?g(t.toLocaleLowerCase()):e}function p(e){let t=l.decoder1252.decode(new Uint8Array([e]));return 402==t.codePointAt(0)||181==t.codePointAt(0)||223==t.codePointAt(0)||"µ"==t||"ƒ"==t||"ß"==t?e:RegExp("^\\p{Letter}$","u").test(t)?g(t.toLocaleUpperCase()):e}function m(e,t,r){let s=this.getString(e,void 0,r),o=this.getString(t,void 0,r);return new Intl.Collator().compare(s,o)}function f(e,t){let r=new Date(1e3*t);this.setLong(e,r.getSeconds()),this.setLong(e+4,r.getMinutes()),this.setLong(e+8,r.getHours()),this.setLong(e+12,r.getDate()),this.setLong(e+16,r.getMonth()),this.setLong(e+20,r.getFullYear()-1900),this.setLong(e+24,r.getDay()),this.setLong(e+28,function(e){let t=new Date(e.getFullYear(),0,1);return Math.floor((e.getTime()-t.getTime())/864e5)}(r)),this.setLong(e+32,new Date().toLocaleTimeString("en-US",{timeZoneName:"long"}).includes("Daylight")?1:0),this.setLong(e+36,-(60*r.getTimezoneOffset())),this.setLong(e+40,E(this,r.toLocaleTimeString("en-US",{timeZoneName:"short"}).split(" ").pop()||"UTC",s))}function w(e,t,r,s){let o=E(e,r,s);e.setLong(t,o)}function E(e,t,r){let s=e.stringToU8(t,r),o=(0,e.exports.malloc)(s.length+1);return e.mem8.set(s,o),e.mem8[o+s.length]=0,o}function T(e,t){let r=new Intl.NumberFormat().format(1.1).replace(/[0-9]/g,"").charAt(0),s=new Intl.NumberFormat(void 0,{minimumFractionDigits:0}).format(1e3).replace(/[0-9]/g,"").charAt(0);w(this,e+0,r,t),w(this,e+4,s,t),w(this,e+20,r,t),w(this,e+24,s,t),w(this,e+24,s,t),w(this,e+24,s,t),w(this,e+32,"+",t),w(this,e+36,"-",t),w(this,e+12,C(),t),w(this,e+16,C(),t)}function C(){switch(navigator.language){case"en-US":case"en-CA":case"fr-CA":case"en-AU":case"es-MX":case"es-AR":case"es-CL":case"es-CO":case"es-EC":case"en-GY":case"nl-SR":case"es-UY":case"en-BZ":case"es-SV":case"es-PA":return"$";case"es-BO":case"es-VE":return"Bs.";case"es-PY":return"₲";case"es-PE":return"S/";case"es-CR":return"₡";case"es-GT":return"Q";case"es-HN":return"L";case"es-NI":return"C$";case"en-GB":return"£";case"en-IE":case"de-DE":case"fr-FR":case"de-AT":case"nl-BE":case"fr-BE":case"el-CY":case"et-EE":case"fi-FI":case"sv-FI":case"el-GR":case"it-IT":case"lv-LV":case"lt-LT":case"fr-LU":case"de-LU":case"lb-LU":case"mt-MT":case"nl-NL":case"pt-PT":case"sk-SK":case"sl-SI":case"es-ES":return"€";case"ja-JP":case"zh-CN":return"¥";case"de-CH":case"fr-CH":case"it-CH":return"CHF";case"sv-SE":case"da-DK":case"nb-NO":return"kr";case"ru-RU":return"₽";case"ko-KR":return"₩";case"en-IN":return"₹";case"pt-BR":return"R$";case"he-IL":return"₪";case"tr-TR":return"₺";default:return""}}function b(e){let t=(0,this.exports.malloc)(160);for(let r=0;r<7;r++)w(this,t+4*r,A(r,"long"),e);for(let r=0;r<7;r++)w(this,t+(r+7)*4,A(r,"short"),e);for(let r=0;r<12;r++)w(this,t+(r+14)*4,S(r,"long"),e);for(let r=0;r<12;r++)w(this,t+(r+14+12)*4,S(r,"short"),e);return w(this,t+152,function(){let e=new Date(2e3,0,1,9,0,0),t=new Intl.DateTimeFormat(void 0,{hour:"numeric",hour12:!0}).formatToParts(e).find(e=>"dayPeriod"===e.type);return t?t.value:""}(),e),w(this,t+156,function(){let e=new Date(2e3,0,1,15,0,0),t=new Intl.DateTimeFormat(void 0,{hour:"numeric",hour12:!0}).formatToParts(e).find(e=>"dayPeriod"===e.type);return t?t.value:""}(),e),t}function A(e,t){let r=new Date;return r.setDate(r.getDate()-r.getDay()+e),new Intl.DateTimeFormat(void 0,{weekday:t}).format(r)}function S(e,t){let r=new Intl.DateTimeFormat(void 0,{month:t}),s=new Date(2e3,e,1);return r.format(s)}}),n("5savl",function(e,r){t(e.exports,"twrTimeEpochImpl",()=>s);function s(){return Date.now()}}),n("8wznr",function(e,r){t(e.exports,"twrConsoleDiv",()=>l),t(e.exports,"twrConsoleDivProxy",()=>h);var s=i("dRr3I"),o=i("7qrGZ"),n=i("4Jz48"),a=i("6MgDX");class l{element;id;keys;CURSOR=String.fromCharCode(9611);cursorOn=!1;lastChar=0;extraBR=!1;cpTranslate;constructor(e,t){if(this.element=e,!(e&&e instanceof HTMLDivElement))throw Error("Invalid HTMLDivElement parameter in twrConsoleDiv constructor ");t&&(t.backColor&&(this.element.style.backgroundColor=t.backColor),t.foreColor&&(this.element.style.color=t.foreColor),t.fontSize&&(this.element.style.font=t.fontSize.toString()+"px arial")),this.cpTranslate=new o.twrCodePageToUnicodeCodePoint,this.id=(0,a.twrConsoleRegistry).registerConsole(this)}isHtmlEntityAtEnd(e){return/&[^;]+;$/.test(e)}removeHtmlEntityAtEnd(e){return e.replace(/&[^;]+;$/,"")}charOut(e,t){if(!this.element)throw Error("internal error");this.extraBR&&(this.extraBR=!1,this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1)),this.element.innerHTML=this.element.innerHTML.slice(0,-4),this.cursorOn&&(this.element.innerHTML+=this.CURSOR));let r=this.cpTranslate.convert(e,t);if(0!=r){switch(r){case 10:case 13:if(10==e&&13==this.lastChar)break;this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1)),this.element.innerHTML+="<br><br>",this.extraBR=!0,this.cursorOn&&(this.element.innerHTML+=this.CURSOR);let t=this.element.getBoundingClientRect();window.scrollTo(0,t.height+100);break;case 8:this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1)),this.isHtmlEntityAtEnd(this.element.innerHTML)?this.element.innerHTML=this.removeHtmlEntityAtEnd(this.element.innerHTML):this.element.innerHTML=this.element.innerHTML.slice(0,-1),this.cursorOn&&(this.element.innerHTML+=this.CURSOR);break;case 14:this.cursorOn||(this.cursorOn=!0,this.element.innerHTML+=this.CURSOR,this.element.focus());break;case 15:this.cursorOn&&(this.cursorOn=!1,this.element.innerHTML=this.element.innerHTML.slice(0,-1));break;default:this.cursorOn&&(this.element.innerHTML=this.element.innerHTML.slice(0,-1));let s=String.fromCodePoint(r);" "==s&&(s="&nbsp;"),this.element.innerHTML+=s,this.cursorOn&&(this.element.innerHTML+=this.CURSOR)}this.lastChar=r}}getProp(e){return"type"===e?n.IOTypes.CHARWRITE|n.IOTypes.CHARREAD:(console.log("twrConsoleDiv.getProp passed unknown property name: ",e),0)}getProxyParams(){return this.keys=new s.twrSharedCircularBuffer,["twrConsoleDivProxy",this.id,this.keys.sharedArray]}keyDown(e){(0,n.keyDownUtil)(this,e)}processMessage(e,t){let[r,...s]=t;if(r!=this.id)throw Error("internal error");switch(e){case"div-charout":{let[e,t]=s;this.charOut(e,t)}break;case"div-putstr":{let[e]=s;this.putStr(e)}break;case"div-focus":this.element.focus();break;default:return!1}return!0}putStr(e){for(let t=0;t<e.length;t++)this.charOut(e.codePointAt(t)||0,o.codePageUTF32)}}class h{keys;id;constructor(e){let[t,r,o]=e;this.keys=new s.twrSharedCircularBuffer(o),this.id=r}charIn(){return this.keys.readWait()}inkey(){return this.keys.isEmpty()?0:this.charIn()}charOut(e,t){postMessage(["div-charout",[this.id,e,t]])}putStr(e){postMessage(["div-putstr",[this.id,e]])}getProp(e){return"type"===e?n.IOTypes.CHARWRITE|n.IOTypes.CHARREAD:(console.log("twrConsoleDivProxy.getProp passed unknown property name: ",e),0)}setFocus(){postMessage(["div-focus",[this.id]])}}}),n("dRr3I",function(e,r){t(e.exports,"twrSharedCircularBuffer",()=>s);class s{sharedArray;buf;constructor(e){if("undefined"!=typeof window&&!crossOriginIsolated&&"file:"!==window.location.protocol)throw Error("twrSharedCircularBuffer constructor, crossOriginIsolated="+crossOriginIsolated+". See SharedArrayBuffer docs.");e?this.sharedArray=e:this.sharedArray=new SharedArrayBuffer(1032),this.buf=new Int32Array(this.sharedArray),this.buf[256]=0,this.buf[257]=0}write(e){let t=this.buf[257];this.buf[t]=e,256==++t&&(t=0),this.buf[257]=t,Atomics.notify(this.buf,257)}read(){if(this.isEmpty())return -1;{let e=this.buf[256],t=this.buf[e];return e++,this.buf[256]=e,t}}readWait(){if(this.isEmpty()){let e=this.buf[256];Atomics.wait(this.buf,257,e)}return this.read()}isEmpty(){return this.buf[256]==this.buf[257]}}}),n("4Jz48",function(e,r){t(e.exports,"IOTypes",()=>s),t(e.exports,"keyDownUtil",()=>o);class s{static CHARREAD=1;static CHARWRITE=2;static ADDRESSABLE_DISPLAY=4;static CANVAS2D=8;static EVENTS=16;constructor(){}}function o(e,t){if(e.keys){let r=function(e){if(e.isComposing||e.metaKey||"Control"==e.key||"Alt"==e.key)console.log("keyEventProcess SKIPPED-2: ",e.key,e.code,e.key.codePointAt(0),e);else{if(1==e.key.length)return e.key.codePointAt(0);switch(e.key){case"Backspace":return 8;case"Enter":return 10;case"Escape":return 27;case"Delete":return 127;case"ArrowLeft":return 8592;case"ArrowUp":return 8593;case"ArrowRight":return 8594;case"ArrowDown":return 8595}console.log("keyEventProcess SKIPPED: ",e.key,e.code,e.key.codePointAt(0),e)}}(t);r&&e.keys.write(r)}else throw Error("keyDown requires twrModuleAsync")}}),n("6MgDX",function(e,r){t(e.exports,"twrConsoleRegistry",()=>s),t(e.exports,"twrConsoleProxyRegistry",()=>o);class s{static consoles=[];static registerConsole(e){return s.consoles.push(e),s.consoles.length-1}static getConsole(e){if(e<0||e>=s.consoles.length)throw Error("Invalid console ID: "+e);return s.consoles[e]}static getConsoleID(e){for(let t=0;t<s.consoles.length;t++)if(s.consoles[t]==e)return t;throw Error("IConsole not in registry")}}class o{static consoles=[];static registerConsoleProxy(e){return o.consoles[e.id]=e,e.id}static getConsoleProxy(e){if(e<0||e>=o.consoles.length)throw Error("Invalid console ID: "+e);return o.consoles[e]}static getConsoleID(e){for(let t=0;t<o.consoles.length;t++)if(o.consoles[t]==e)return t;throw Error("IConsoleProxy not in registry")}}}),n("eEBf6",function(e,r){t(e.exports,"twrWaitingCalls",()=>o),t(e.exports,"twrWaitingCallsProxy",()=>n);var s=i("3k1GP");class o{callCompleteSignal;parameters;constructor(){this.callCompleteSignal=new s.twrSignal,this.parameters=new Uint32Array(new SharedArrayBuffer(4))}startSleep(e){setTimeout(()=>{this.callCompleteSignal.signal()},e)}getProxyParams(){return[this.callCompleteSignal.sharedArray,this.parameters.buffer]}processMessage(e,t){if("sleep"!==e)return!1;{let[e]=t;this.startSleep(e)}return!0}}class n{callCompleteSignal;parameters;constructor(e){this.callCompleteSignal=new s.twrSignal(e[0]),this.parameters=new Uint32Array(e[1])}sleep(e){this.callCompleteSignal.reset(),postMessage(["sleep",[e]]),this.callCompleteSignal.wait()}}}),n("3k1GP",function(e,r){var s,o;t(e.exports,"twrSignal",()=>i),(o=s||(s={}))[o.WAITING=0]="WAITING",o[o.SIGNALED=1]="SIGNALED";class i{sharedArray;buf;constructor(e){if("undefined"!=typeof window&&!crossOriginIsolated&&"file:"!==window.location.protocol)throw Error("twrSignal constructor, crossOriginIsolated="+crossOriginIsolated+". See SharedArrayBuffer docs.");e?this.sharedArray=e:this.sharedArray=new SharedArrayBuffer(4),this.buf=new Int32Array(this.sharedArray),this.buf[0]=s.WAITING}signal(){this.buf[0]=s.SIGNALED,Atomics.notify(this.buf,0)}wait(){this.buf[0]==s.WAITING&&Atomics.wait(this.buf,0,s.WAITING)}isSignaled(){return this.buf[0]==s.SIGNALED}reset(){this.buf[0]=s.WAITING}}}),n("8vcno",function(e,r){t(e.exports,"twrConsoleCanvas",()=>c),t(e.exports,"twrConsoleCanvasProxy",()=>u);var s,o,n=i("dRr3I"),a=i("3k1GP"),l=i("4Jz48"),h=i("6MgDX");(s=o||(o={}))[s.D2D_FILLRECT=1]="D2D_FILLRECT",s[s.D2D_FILLCODEPOINT=5]="D2D_FILLCODEPOINT",s[s.D2D_SETLINEWIDTH=10]="D2D_SETLINEWIDTH",s[s.D2D_SETFILLSTYLERGBA=11]="D2D_SETFILLSTYLERGBA",s[s.D2D_SETFONT=12]="D2D_SETFONT",s[s.D2D_BEGINPATH=13]="D2D_BEGINPATH",s[s.D2D_MOVETO=14]="D2D_MOVETO",s[s.D2D_LINETO=15]="D2D_LINETO",s[s.D2D_FILL=16]="D2D_FILL",s[s.D2D_STROKE=17]="D2D_STROKE",s[s.D2D_SETSTROKESTYLERGBA=18]="D2D_SETSTROKESTYLERGBA",s[s.D2D_ARC=19]="D2D_ARC",s[s.D2D_STROKERECT=20]="D2D_STROKERECT",s[s.D2D_FILLTEXT=21]="D2D_FILLTEXT",s[s.D2D_IMAGEDATA=22]="D2D_IMAGEDATA",s[s.D2D_PUTIMAGEDATA=23]="D2D_PUTIMAGEDATA",s[s.D2D_BEZIERTO=24]="D2D_BEZIERTO",s[s.D2D_MEASURETEXT=25]="D2D_MEASURETEXT",s[s.D2D_SAVE=26]="D2D_SAVE",s[s.D2D_RESTORE=27]="D2D_RESTORE",s[s.D2D_CREATERADIALGRADIENT=28]="D2D_CREATERADIALGRADIENT",s[s.D2D_SETCOLORSTOP=29]="D2D_SETCOLORSTOP",s[s.D2D_SETFILLSTYLEGRADIENT=30]="D2D_SETFILLSTYLEGRADIENT",s[s.D2D_RELEASEID=31]="D2D_RELEASEID",s[s.D2D_CREATELINEARGRADIENT=32]="D2D_CREATELINEARGRADIENT",s[s.D2D_SETFILLSTYLE=33]="D2D_SETFILLSTYLE",s[s.D2D_SETSTROKESTYLE=34]="D2D_SETSTROKESTYLE",s[s.D2D_CLOSEPATH=35]="D2D_CLOSEPATH",s[s.D2D_RESET=36]="D2D_RESET",s[s.D2D_CLEARRECT=37]="D2D_CLEARRECT",s[s.D2D_SCALE=38]="D2D_SCALE",s[s.D2D_TRANSLATE=39]="D2D_TRANSLATE",s[s.D2D_ROTATE=40]="D2D_ROTATE",s[s.D2D_GETTRANSFORM=41]="D2D_GETTRANSFORM",s[s.D2D_SETTRANSFORM=42]="D2D_SETTRANSFORM",s[s.D2D_RESETTRANSFORM=43]="D2D_RESETTRANSFORM",s[s.D2D_STROKETEXT=44]="D2D_STROKETEXT",s[s.D2D_ROUNDRECT=45]="D2D_ROUNDRECT",s[s.D2D_ELLIPSE=46]="D2D_ELLIPSE",s[s.D2D_QUADRATICCURVETO=47]="D2D_QUADRATICCURVETO",s[s.D2D_SETLINEDASH=48]="D2D_SETLINEDASH",s[s.D2D_GETLINEDASH=49]="D2D_GETLINEDASH",s[s.D2D_ARCTO=50]="D2D_ARCTO",s[s.D2D_GETLINEDASHLENGTH=51]="D2D_GETLINEDASHLENGTH",s[s.D2D_DRAWIMAGE=52]="D2D_DRAWIMAGE",s[s.D2D_RECT=53]="D2D_RECT",s[s.D2D_TRANSFORM=54]="D2D_TRANSFORM",s[s.D2D_SETLINECAP=55]="D2D_SETLINECAP",s[s.D2D_SETLINEJOIN=56]="D2D_SETLINEJOIN",s[s.D2D_SETLINEDASHOFFSET=57]="D2D_SETLINEDASHOFFSET",s[s.D2D_GETIMAGEDATA=58]="D2D_GETIMAGEDATA";class c{ctx;id;element;props;cmdCompleteSignal;canvasKeys;returnValue;isAsyncMod;precomputedObjects;constructor(e){if(this.isAsyncMod=!1,this.precomputedObjects={},!(e&&e instanceof HTMLCanvasElement&&e.getContext))throw Error("Invalid HTMLCanvasElement parameter in twrConsoleCanvas constructor ");this.element=e;let t=e.getContext("2d");if(!t)throw Error("Canvas 2D context not found.");this.ctx=t,t.font="16 px Courier New",t.textBaseline="top",this.props={canvasHeight:e.height,canvasWidth:e.width,type:l.IOTypes.CANVAS2D},this.id=(0,h.twrConsoleRegistry).registerConsole(this)}getProxyParams(){return this.cmdCompleteSignal=new a.twrSignal,this.canvasKeys=new n.twrSharedCircularBuffer,this.returnValue=new n.twrSharedCircularBuffer,this.isAsyncMod=!0,["twrConsoleCanvasProxy",this.id,this.props,this.cmdCompleteSignal.sharedArray,this.canvasKeys.sharedArray,this.returnValue.sharedArray]}getProp(e){return this.props[e]}processMessage(e,t,r){let[s,...o]=t;if(s!=this.id)throw Error("internal error");switch(e){case"canvas2d-drawseq":{let[e]=o;this.drawSeq(e,r);break}case"canvas2d-loadimage":{let[e,t]=o;this.loadImage(e,t,r);break}default:return!1}return!0}loadImage(e,t,r){let s=r.getString(e);t in this.precomputedObjects&&console.log("warning: D2D_LOADIMAGE ID already exists.");let o=new Image,i="`private loadImage` either has an internal error or is being misused";o.onload=()=>{if(this.returnValue)this.returnValue.write(1);else throw Error(i)},o.onerror=()=>{if(this.returnValue)console.log("Warning: D2D_LOADIMAGE: failed to load image "+s),this.returnValue.write(0);else throw Error(i)},o.src=s,this.precomputedObjects[t]=o}drawSeq(e,t){let r;if(!this.ctx)return;let s=t.getLong(e),i=t.getLong(e+4),n=s+16;for(;;){let e=t.getLong(s+4);switch(e){case o.D2D_FILLRECT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24);this.ctx.fillRect(e,r,s,o)}break;case o.D2D_STROKERECT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24);this.ctx.strokeRect(e,r,s,o)}break;case o.D2D_FILLCODEPOINT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=String.fromCodePoint(t.getLong(n+16));this.ctx.fillText(s,e,r)}break;case o.D2D_FILLTEXT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getLong(n+20),o=t.getLong(n+16),i=t.getString(o,void 0,s);this.ctx.fillText(i,e,r)}break;case o.D2D_MEASURETEXT:{let e=t.getLong(n+8),r=t.getString(t.getLong(n),void 0,e),s=t.getLong(n+4),o=this.ctx.measureText(r);t.setDouble(s+0,o.actualBoundingBoxAscent),t.setDouble(s+8,o.actualBoundingBoxDescent),t.setDouble(s+16,o.actualBoundingBoxLeft),t.setDouble(s+24,o.actualBoundingBoxRight),t.setDouble(s+32,o.fontBoundingBoxAscent),t.setDouble(s+40,o.fontBoundingBoxDescent),t.setDouble(s+48,o.width)}break;case o.D2D_SETFONT:{let e=t.getLong(n),r=t.getString(e);this.ctx.font=r}break;case o.D2D_SETFILLSTYLERGBA:{let e="#"+("00000000"+t.getLong(n).toString(16)).slice(-8);this.ctx.fillStyle=e}break;case o.D2D_SETSTROKESTYLERGBA:{let e="#"+("00000000"+t.getLong(n).toString(16)).slice(-8);this.ctx.strokeStyle=e}break;case o.D2D_SETFILLSTYLE:{let e=t.getLong(n),r=t.getString(e);this.ctx.fillStyle=r}break;case o.D2D_SETSTROKESTYLE:{let e=t.getLong(n),r=t.getString(e);this.ctx.strokeStyle=r}break;case o.D2D_SETLINEWIDTH:{let e=t.getDouble(n);this.ctx.lineWidth=e}break;case o.D2D_MOVETO:{let e=t.getDouble(n),r=t.getDouble(n+8);this.ctx.moveTo(e,r)}break;case o.D2D_LINETO:{let e=t.getDouble(n),r=t.getDouble(n+8);this.ctx.lineTo(e,r)}break;case o.D2D_BEZIERTO:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32),a=t.getDouble(n+40);this.ctx.bezierCurveTo(e,r,s,o,i,a)}break;case o.D2D_BEGINPATH:this.ctx.beginPath();break;case o.D2D_FILL:this.ctx.fill();break;case o.D2D_SAVE:this.ctx.save();break;case o.D2D_RESTORE:this.ctx.restore();break;case o.D2D_STROKE:this.ctx.stroke();break;case o.D2D_ARC:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32),a=0!=t.getLong(n+40);this.ctx.arc(e,r,s,o,i,a)}break;case o.D2D_IMAGEDATA:{let e=t.getLong(n),r=t.getLong(n+4),s=t.getLong(n+8),o=t.getLong(n+12),i=t.getLong(n+16);if(i in this.precomputedObjects&&console.log("warning: D2D_IMAGEDATA ID already exists."),this.isAsyncMod)this.precomputedObjects[i]={mem8:new Uint8Array(t.memory.buffer,e,r),width:s,height:o};else{let n=new Uint8ClampedArray(t.memory.buffer,e,r);this.precomputedObjects[i]=new ImageData(n,s,o)}}break;case o.D2D_CREATERADIALGRADIENT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32),a=t.getDouble(n+40),l=t.getLong(n+48),h=this.ctx.createRadialGradient(e,r,s,o,i,a);l in this.precomputedObjects&&console.log("warning: D2D_CREATERADIALGRADIENT ID already exists."),this.precomputedObjects[l]=h}break;case o.D2D_CREATELINEARGRADIENT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getLong(n+32),a=this.ctx.createLinearGradient(e,r,s,o);i in this.precomputedObjects&&console.log("warning: D2D_CREATELINEARGRADIENT ID already exists."),this.precomputedObjects[i]=a}break;case o.D2D_SETCOLORSTOP:{let e=t.getLong(n),r=t.getLong(n+4),s=t.getLong(n+8),o=t.getString(s);if(!(e in this.precomputedObjects))throw Error("D2D_SETCOLORSTOP with invalid ID: "+e);this.precomputedObjects[e].addColorStop(r,o)}break;case o.D2D_SETFILLSTYLEGRADIENT:{let e=t.getLong(n);if(!(e in this.precomputedObjects))throw Error("D2D_SETFILLSTYLEGRADIENT with invalid ID: "+e);let r=this.precomputedObjects[e];this.ctx.fillStyle=r}break;case o.D2D_RELEASEID:{let e=t.getLong(n);this.precomputedObjects[e]?delete this.precomputedObjects[e]:console.log("warning: D2D_RELEASEID with undefined ID ",e)}break;case o.D2D_PUTIMAGEDATA:{let e;let r=t.getLong(n),s=t.getLong(n+4),o=t.getLong(n+8),i=t.getLong(n+12),a=t.getLong(n+16),l=t.getLong(n+20),h=t.getLong(n+24);if(!(r in this.precomputedObjects))throw Error("D2D_PUTIMAGEDATA with invalid ID: "+r);if(this.isAsyncMod){let t=this.precomputedObjects[r];e=new ImageData(Uint8ClampedArray.from(t.mem8),t.width,t.height)}else e=this.precomputedObjects[r];0==l&&0==h?this.ctx.putImageData(e,s,o):this.ctx.putImageData(e,s,o,i,a,l,h)}break;case o.D2D_CLOSEPATH:this.ctx.closePath();break;case o.D2D_RESET:this.ctx.reset();break;case o.D2D_CLEARRECT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24);this.ctx.clearRect(e,r,s,o)}break;case o.D2D_SCALE:{let e=t.getDouble(n),r=t.getDouble(n+8);this.ctx.scale(e,r)}break;case o.D2D_TRANSLATE:{let e=t.getDouble(n),r=t.getDouble(n+8);this.ctx.translate(e,r)}break;case o.D2D_ROTATE:{let e=t.getDouble(n);this.ctx.rotate(e)}break;case o.D2D_GETTRANSFORM:{let e=t.getLong(n),r=this.ctx.getTransform();t.setDouble(e+0,r.a),t.setDouble(e+8,r.b),t.setDouble(e+16,r.c),t.setDouble(e+24,r.d),t.setDouble(e+32,r.e),t.setDouble(e+40,r.f)}break;case o.D2D_SETTRANSFORM:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32),a=t.getDouble(n+40);this.ctx.setTransform(e,r,s,o,i,a)}break;case o.D2D_RESETTRANSFORM:this.ctx.resetTransform();break;case o.D2D_STROKETEXT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getLong(n+20),o=t.getLong(n+16),i=t.getString(o,void 0,s);this.ctx.strokeText(i,e,r)}break;case o.D2D_ROUNDRECT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32);this.ctx.roundRect(e,r,s,o,i)}break;case o.D2D_ELLIPSE:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32),a=t.getDouble(n+40),l=t.getDouble(n+48),h=0!=t.getLong(n+56);this.ctx.ellipse(e,r,s,o,i,a,l,h)}break;case o.D2D_QUADRATICCURVETO:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24);this.ctx.quadraticCurveTo(e,r,s,o)}break;case o.D2D_SETLINEDASH:{let e=t.getLong(n),r=t.getLong(n+4),s=[];for(let o=0;o<e;o++)s[o]=t.getDouble(r+8*o);this.ctx.setLineDash(s)}break;case o.D2D_GETLINEDASH:{let e=this.ctx.getLineDash(),r=t.getLong(n),s=t.getLong(n+4),o=n+8;if(t.setLong(o,e.length),e.length>0){for(let o=0;o<Math.min(e.length,r);o++)t.setDouble(s+8*o,e[o]);e.length>r&&console.log("warning: D2D_GETLINEDASH exceeded given max_length, truncating excess")}}break;case o.D2D_ARCTO:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32);this.ctx.arcTo(e,r,s,o,i)}break;case o.D2D_GETLINEDASHLENGTH:t.setLong(n,this.ctx.getLineDash().length);break;case o.D2D_DRAWIMAGE:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getLong(n+16);if(!(s in this.precomputedObjects))throw Error("D2D_DRAWIMAGE with invalid ID: "+s);let o=this.precomputedObjects[s];this.ctx.drawImage(o,e,r)}break;case o.D2D_RECT:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24);this.ctx.rect(e,r,s,o)}break;case o.D2D_TRANSFORM:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getDouble(n+32),a=t.getDouble(n+40);this.ctx.transform(e,r,s,o,i,a)}break;case o.D2D_SETLINECAP:{let e=t.getLong(n),r=t.getString(e);this.ctx.lineCap=r}break;case o.D2D_SETLINEJOIN:{let e=t.getLong(n),r=t.getString(e);this.ctx.lineJoin=r}break;case o.D2D_SETLINEDASHOFFSET:{let e=t.getDouble(n);this.ctx.lineDashOffset=e}break;case o.D2D_GETIMAGEDATA:{let e=t.getDouble(n),r=t.getDouble(n+8),s=t.getDouble(n+16),o=t.getDouble(n+24),i=t.getLong(n+32),a=t.getLong(n+36),l=this.ctx.getImageData(e,r,s,o),h=l.data.byteLength;console.log("img len: ",h),h>a&&console.log("Warning: D2D_GETIMAGEDATA was given a buffer smaller than the image size! Extra data is being truncated"),t.mem8.set(l.data.slice(0,Math.min(a,h)),i)}break;default:throw Error("unimplemented or unknown Sequence Type in drawSeq: "+e)}if(0==(r=t.getLong(s))){if(s!=i)throw Error("assert type error in twrcanvas, ins!=lastins");break}n=(s=r)+16}this.cmdCompleteSignal&&this.cmdCompleteSignal.signal()}}class u{canvasKeys;drawCompleteSignal;props;id;returnValue;constructor(e){let[t,r,s,o,i,l]=e;this.drawCompleteSignal=new a.twrSignal(o),this.canvasKeys=new n.twrSharedCircularBuffer(i),this.returnValue=new n.twrSharedCircularBuffer(l),this.props=s,this.id=r}charIn(){return this.canvasKeys.readWait()}inkey(){return this.canvasKeys.isEmpty()?0:this.charIn()}getProp(e){return this.props[e]}drawSeq(e){this.drawCompleteSignal.reset(),postMessage(["canvas2d-drawseq",[this.id,e]]),this.drawCompleteSignal.wait()}loadImage(e,t){return postMessage(["canvas2d-loadimage",[this.id,e,t]]),this.returnValue.readWait()}}}),n("9kgjF",function(e,r){t(e.exports,"twrConsoleDebug",()=>a),t(e.exports,"twrConsoleDebugProxy",()=>l);var s=i("4Jz48"),o=i("7qrGZ"),n=i("6MgDX");class a{logline="";element=void 0;id;cpTranslate;constructor(){this.id=(0,n.twrConsoleRegistry).registerConsole(this),this.cpTranslate=new o.twrCodePageToUnicodeCodePoint}charOut(e,t){let r=this.cpTranslate.convert(e,t);10==r||3==r?(console.log(this.logline),this.logline=""):(this.logline=this.logline+String.fromCodePoint(r),this.logline.length>=300&&(console.log(this.logline),this.logline=""))}getProp(e){return"type"===e?s.IOTypes.CHARWRITE:(console.log("twrConsoleDebug.getProp passed unknown property name: ",e),0)}getProxyParams(){return["twrConsoleDebugProxy",this.id]}keyDown(e){throw Error("twrConsoleDebug does not support character input")}processMessage(e,t,r){let[s,...o]=t;if(s!=this.id)throw Error("internal error");switch(e){case"debug-charout":{let[e,t]=o;this.charOut(e,t)}break;case"debug-putstr":{let[e]=o;this.putStr(e)}break;default:return!1}return!0}putStr(e){for(let t=0;t<e.length;t++)this.charOut(e.codePointAt(t)||0,o.codePageUTF32)}}class l{id;constructor(e){this.id=e[1]}charIn(){return 0}setFocus(){}charOut(e,t){postMessage(["debug-charout",[this.id,e,t]])}putStr(e){postMessage(["debug-putstr",[this.id,e]])}getProp(e){return"type"===e?s.IOTypes.CHARWRITE:(console.log("twrConsoleDebugProxy.getProp passed unknown property name: ",e),0)}}}),n("a7Sa2",function(e,r){t(e.exports,"twrConsoleTerminal",()=>l),t(e.exports,"twrConsoleTerminalProxy",()=>h);var s=i("dRr3I"),o=i("7qrGZ"),n=i("4Jz48"),a=i("6MgDX");class l{element;id;ctx;keys;returnValue;props;size;cellWidth;cellHeight;cellW1;cellW2;cellH1;cellH2;cellH3;isCursorVisible;videoMem;foreColorMem;backColorMem;cpTranslate;constructor(e,t={}){let{foreColor:r="white",backColor:s="black",fontSize:i=16,widthInChars:l=80,heightInChars:h=25}=t;if(this.element=e,!(e&&e instanceof HTMLCanvasElement&&e.getContext))throw Error("Invalid HTMLCanvasElement parameter in twrConsoleTerminal constructor ");let c=e.getContext("2d");if(!c)throw Error("canvasElement.getContext('2d') failed");c.font=i.toString()+"px Courier New",c.textBaseline="top";let u="          ",g=Math.ceil(c.measureText(u).width/u.length),d=c.measureText("X"),D=Math.ceil(d.fontBoundingBoxAscent+d.fontBoundingBoxDescent);e.width=g*l,e.height=D*h;let p=e.height,m=e.width,f=e.getContext("2d");if(!f)throw Error("canvas 2D context not found in twrCanvas.constructor (2nd time)");this.ctx=f,this.ctx.font=i.toString()+"px Courier New",this.ctx.textBaseline="top",f.fillStyle=s;let w=Number("0x"+f.fillStyle.slice(1));f.fillStyle=r;let E=Number("0x"+f.fillStyle.slice(1)),T=n.IOTypes.CHARWRITE|n.IOTypes.CHARREAD|n.IOTypes.ADDRESSABLE_DISPLAY;if(this.props={type:T,cursorPos:0,foreColorAsRGB:E,backColorAsRGB:w,fontSize:i,widthInChars:l,heightInChars:h,canvasHeight:p,canvasWidth:m,charWidth:g,charHeight:D},this.isCursorVisible=!1,this.size=this.props.widthInChars*this.props.heightInChars,this.videoMem=Array(this.size),this.foreColorMem=Array(this.size),this.backColorMem=Array(this.size),this.cellWidth=this.props.charWidth,this.cellHeight=this.props.charHeight,this.cellWidth<=0)throw Error("invalid cellWidth");if(this.cellHeight<=0)throw Error("invalid cellHeight");this.cellW1=Math.floor(this.cellWidth/2),this.cellW2=this.cellWidth-this.cellW1,this.cellH1=Math.floor(this.cellHeight/3),this.cellH2=this.cellH1,this.cellH3=this.cellHeight-this.cellH1-this.cellH2,this.cls(),this.cpTranslate=new o.twrCodePageToUnicodeCodePoint,this.id=(0,a.twrConsoleRegistry).registerConsole(this)}getProxyParams(){if(this.returnValue||this.keys)throw Error("internal error -- getProxyParams unexpectedly called twice.");return this.returnValue=new s.twrSharedCircularBuffer,this.keys=new s.twrSharedCircularBuffer,["twrConsoleTerminalProxy",this.id,this.returnValue.sharedArray,this.keys.sharedArray]}getProp(e){return this.props[e]}keyDown(e){(0,n.keyDownUtil)(this,e)}processMessage(e,t){let[r,...s]=t;if(r!=this.id)throw Error("internal error");switch(e){case"term-getprop":let[o]=s,i=this.getProp(o);this.returnValue.write(i);break;case"term-point":{let[e,t]=s,r=this.point(e,t);this.returnValue.write(r?1:0)}break;case"term-charout":{let[e,t]=s;this.charOut(e,t)}break;case"term-putstr":{let[e]=s;this.putStr(e)}break;case"term-cls":this.cls();break;case"term-setrange":{let[e,t]=s;this.setRange(e,t)}break;case"term-setc32":{let[e,t]=s;this.setC32(e,t)}break;case"term-setreset":{let[e,t,r]=s;this.setReset(e,t,r)}break;case"term-setcursor":{let[e]=s;this.setCursor(e)}break;case"term-setcursorxy":{let[e,t]=s;this.setCursorXY(e,t)}break;case"term-setcolors":{let[e,t]=s;this.setColors(e,t)}break;case"term-focus":this.element.focus();break;default:return!1}return!0}RGB_TO_RGBA(e){return e<<8|255}eraseLine(){for(let e=this.props.cursorPos;e<Math.floor(this.props.cursorPos/this.props.widthInChars)*this.props.widthInChars+this.props.widthInChars;e++)this.setC32(e,32)}charOut(e,t){if(13==e||10==e)this.isCursorVisible&&this.setC32(this.props.cursorPos,32),this.props.cursorPos=Math.floor(this.props.cursorPos/this.props.widthInChars),this.props.cursorPos=this.props.cursorPos*this.props.widthInChars,this.props.cursorPos=this.props.cursorPos+this.props.widthInChars,this.props.cursorPos<this.size&&this.eraseLine();else if(8==e)this.props.cursorPos>0&&(this.isCursorVisible&&this.setC32(this.props.cursorPos,32),this.props.cursorPos--,this.setC32(this.props.cursorPos,32));else if(14==e)this.isCursorVisible=!0;else if(15==e)this.setC32(this.props.cursorPos,32),this.isCursorVisible=!1;else if(24==e)this.props.cursorPos>0&&this.props.cursorPos--;else if(25==e)this.props.cursorPos<this.size-1&&this.props.cursorPos++;else if(26==e)this.props.cursorPos<this.props.widthInChars*(this.props.heightInChars-1)&&(this.props.cursorPos+=this.props.widthInChars);else if(27==e)this.props.cursorPos>=this.props.widthInChars&&(this.props.cursorPos-=this.props.widthInChars);else if(28==e)this.props.cursorPos=0;else if(29==e)this.props.cursorPos=this.props.cursorPos/this.props.widthInChars*this.props.widthInChars;else if(30==e)this.eraseLine();else if(31==e)for(let e=this.props.cursorPos;e<this.size;e++)this.setC32(e,32);else{let r=this.cpTranslate.convert(e,t);0!=r&&(this.setC32(this.props.cursorPos,r),this.props.cursorPos++)}if(this.props.cursorPos==this.size){this.props.cursorPos=this.props.widthInChars*(this.props.heightInChars-1);for(let e=0;e<this.props.widthInChars*(this.props.heightInChars-1);e++)this.videoMem[e]=this.videoMem[e+this.props.widthInChars],this.backColorMem[e]=this.backColorMem[e+this.props.widthInChars],this.foreColorMem[e]=this.foreColorMem[e+this.props.widthInChars];for(let e=0;e<this.props.widthInChars;e++)this.videoMem[this.size-e-1]=32,this.backColorMem[this.size-e-1]=this.props.backColorAsRGB,this.foreColorMem[this.size-e-1]=this.props.foreColorAsRGB;this.drawRange(0,this.size-1)}if(this.isCursorVisible&&this.setC32(this.props.cursorPos,9611),this.props.cursorPos>=this.size)throw Error("twrTerm: assert: this.props.cursorPos >= this.size")}putStr(e){for(let t=0;t<e.length;t++)this.charOut(e.codePointAt(t)||0,o.codePageUTF32)}setC32(e,t){if(!(e>=0&&e<this.size))throw Error("Invalid location passed to setc32");this.videoMem[e]=t,this.backColorMem[e]=this.props.backColorAsRGB,this.foreColorMem[e]=this.props.foreColorAsRGB;let r=e-1;r<0&&(r=0);let s=e+1;s>=this.size&&(s=this.size-1),this.drawRange(r,s);let o=r,i=s;r-=this.props.widthInChars,s-=this.props.widthInChars,r<0&&(r=0),s<0&&(s=0),this.drawRange(r,s),r=o+this.props.widthInChars,s=i+this.props.widthInChars,r>=this.size&&(r=this.size-1),s>=this.size&&(s=this.size-1),this.drawRange(r,s)}cls(){for(let e=0;e<this.size;e++)this.videoMem[e]=32,this.backColorMem[e]=this.props.backColorAsRGB,this.foreColorMem[e]=this.props.foreColorAsRGB;this.props.cursorPos=0,this.isCursorVisible=!1,this.drawRange(0,this.size-1)}setFillStyleRGB(e){let t=`#${e.toString(16).padStart(6,"0")}`;this.ctx.fillStyle=t}drawTrs80Graphic(e,t,r,s){let o,i;o=e%this.props.widthInChars*this.cellWidth,i=Math.floor(e/this.props.widthInChars)*this.cellHeight,this.setFillStyleRGB(s),this.ctx.fillRect(o,i,this.cellWidth,this.cellHeight),32!=t&&(this.setFillStyleRGB(r),1&t&&this.ctx.fillRect(o,i,this.cellW1,this.cellH1),i+=this.cellH1,4&t&&this.ctx.fillRect(o,i,this.cellW1,this.cellH2),i+=this.cellH2,16&t&&this.ctx.fillRect(o,i,this.cellW1,this.cellH3),o+=this.cellW1,32&t&&this.ctx.fillRect(o,i,this.cellW2,this.cellH3),i-=this.cellH2,8&t&&this.ctx.fillRect(o,i,this.cellW2,this.cellH2),i-=this.cellH1,2&t&&this.ctx.fillRect(o,i,this.cellW2,this.cellH1))}drawCell(e,t,r,s){if((65280&t)==57344||32==t)this.drawTrs80Graphic(e,63&t,r,s);else{let o,i;if(o=e%this.props.widthInChars*this.cellWidth,i=Math.floor(e/this.props.widthInChars)*this.cellHeight,this.setFillStyleRGB(s),this.ctx.fillRect(o,i,this.cellWidth,this.cellHeight),32!=t){this.setFillStyleRGB(r);let e=String.fromCodePoint(t);this.ctx.fillText(e,o,i)}}}setRange(e,t){let r=0;for(let s=e;s<e+t.length;s++)this.videoMem[s]=t[r++];this.drawRange(e,e+t.length-1)}drawRange(e,t){for(let r=e;r<=t;r++)this.drawCell(r,this.videoMem[r],this.foreColorMem[r],this.backColorMem[r])}setReset(e,t,r){let s=Math.floor(e/2)+this.props.widthInChars*Math.floor(t/3),o=e%2,i=t%3;if(e<0||e>2*this.props.widthInChars)throw Error("setReset: invalid x value");if(t<0||t>3*this.props.heightInChars)throw Error("setReset: invalid y value");(65280&this.videoMem[s])!=57344&&(this.videoMem[s]=57344,this.backColorMem[s]=this.props.backColorAsRGB,this.foreColorMem[s]=this.props.foreColorAsRGB),r?this.videoMem[s]|=1<<2*i+o:this.videoMem[s]&=~(1<<2*i+o),this.drawRange(s,s)}point(e,t){let r=Math.floor(e/2)+this.props.widthInChars*Math.floor(t/3);if(e<0||e>2*this.props.widthInChars)throw Error("Point: invalid x value");if(t<0||t>3*this.props.heightInChars)throw Error("Point: invalid y value");return(65280&this.videoMem[r])==57344&&!!(this.videoMem[r]&1<<t%3*2+e%2)}setCursor(e){if(e<0||e>=this.size)throw Error("setCursor: invalid location: "+e);this.props.cursorPos=e}setCursorXY(e,t){if(e<0||t<0||this.props.widthInChars*t+e>=this.size)throw Error("setCursorXY: invalid parameter(s)");this.setCursor(this.props.widthInChars*t+e)}setColors(e,t){this.props.foreColorAsRGB=e,this.props.backColorAsRGB=t}}class h{keys;returnValue;id;constructor(e){let[t,r,o,i]=e;this.keys=new s.twrSharedCircularBuffer(i),this.returnValue=new s.twrSharedCircularBuffer(o),this.id=r}getProp(e){return postMessage(["term-getprop",[this.id,e]]),this.returnValue.readWait()}charIn(){return this.keys.readWait()}point(e,t){return postMessage(["term-point",[this.id,e,t]]),0!=this.returnValue.readWait()}charOut(e,t){postMessage(["term-charout",[this.id,e,t]])}putStr(e){postMessage(["term-putstr",[this.id,e]])}cls(){postMessage(["term-cls",[this.id]])}setRange(e,t){postMessage(["term-setrange",[this.id,e,t]])}setC32(e,t){postMessage(["term-setc32",[this.id,e,t]])}setReset(e,t,r){postMessage(["term-setreset",[this.id,e,t,r]])}setCursor(e){postMessage(["term-setcursor",[this.id,e]])}setCursorXY(e,t){postMessage(["term-setcursorxy",[this.id,e,t]])}setColors(e,t){postMessage(["term-setcolors",[this.id,e,t]])}setFocus(){postMessage(["term-focus",[this.id]])}}}),t({},"twrWasmModuleAsyncProxy",()=>m);var a=i("jhM3f"),l=i("5savl"),h=i("7qrGZ"),c=i("8wznr"),u=i("eEBf6"),g=i("8vcno"),d=i("9kgjF"),D=i("a7Sa2"),p=i("6MgDX");self.onmessage=function(t){if("startup"==t.data[0]){let r=t.data[1];(e=new m(r.allProxyParams)).loadWasm(r.urlToLoad).then(()=>{postMessage(["startupOkay"])}).catch(e=>{console.log(".catch: ",e),postMessage(["startupFail",e])})}else if("callC"==t.data[0]){let[r,s,o,i]=t.data;e.callCImpl(o,i).then(e=>{postMessage(["callCOkay",s,e])}).catch(e=>{console.log("exception in callC in 'twrmodasyncproxy.js': \n",t.data[1],t.data[2]),console.log(e),postMessage(["callCFail",s,e])})}else console.log("twrmodasyncproxy.js: unknown message: "+t)};class m extends a.twrWasmModuleBase{malloc;imports;ioNamesToID;cpTranslate;getProxyInstance(e){let t=e[0];switch(t){case"twrConsoleDivProxy":return new c.twrConsoleDivProxy(e);case"twrConsoleTerminalProxy":return new D.twrConsoleTerminalProxy(e);case"twrConsoleDebugProxy":return new d.twrConsoleDebugProxy(e);case"twrConsoleCanvasProxy":return new g.twrConsoleCanvasProxy(e);default:throw Error("Unknown class name passed to getProxyClassConstructor: "+t)}}constructor(e){super(),this.isAsyncProxy=!0,this.malloc=e=>{throw Error("error - un-init malloc called")},this.cpTranslate=new h.twrCodePageToUnicodeCodePoint,this.ioNamesToID=e.ioNamesToID;for(let t=0;t<e.conProxyParams.length;t++){let r=e.conProxyParams[t],s=this.getProxyInstance(r);(0,p.twrConsoleProxyRegistry).registerConsoleProxy(s)}let t=new u.twrWaitingCallsProxy(e.waitingCallsProxyParams),r=(e,t,...r)=>{let s=(0,p.twrConsoleProxyRegistry).getConsoleProxy(t),o=s[e];if(!o)throw Error(`Likely using an incorrect console type. jsid=${t}, funcName=${e}`);return o.call(s,...r)};this.imports={twrTimeEpoch:l.twrTimeEpochImpl,twrTimeTmLocal:(0,h.twrTimeTmLocalImpl).bind(this),twrUserLconv:(0,h.twrUserLconvImpl).bind(this),twrUserLanguage:(0,h.twrUserLanguageImpl).bind(this),twrRegExpTest1252:(0,h.twrRegExpTest1252Impl).bind(this),twrToLower1252:(0,h.twrToLower1252Impl).bind(this),twrToUpper1252:(0,h.twrToUpper1252Impl).bind(this),twrStrcoll:(0,h.twrStrcollImpl).bind(this),twrUnicodeCodePointToCodePage:(0,h.twrUnicodeCodePointToCodePageImpl).bind(this),twrCodePageToUnicodeCodePoint:this.cpTranslate.convert.bind(this.cpTranslate),twrGetDtnames:(0,h.twrGetDtnamesImpl).bind(this),twrGetConIDFromName:e=>{let t=this.getString(e);return this.ioNamesToID[t]||-1},twrSleep:t.sleep.bind(t),twrConCharOut:r.bind(null,"charOut"),twrConCharIn:r.bind(null,"charIn"),twrSetFocus:r.bind(null,"setFocus"),twrConGetProp:(e,t)=>r("getProp",e,this.getString(t)),twrConCls:r.bind(null,"cls"),twrConSetC32:r.bind(null,"setC32"),twrConSetReset:r.bind(null,"setReset"),twrConPoint:r.bind(null,"point"),twrConSetCursor:r.bind(null,"setCursor"),twrConSetColors:r.bind(null,"setColors"),twrConSetRange:(e,t,s,o)=>{let i=[];for(let e=s;e<s+o;e++)i.push(this.getLong(e));r("setRange",e,s,i)},twrConPutStr:(e,t,s)=>{r("putStr",e,this.getString(t),s)},twrConDrawSeq:(e,t)=>{r("drawSeq",e,t,this)},twrConLoadImage:r.bind(null,"loadImage"),twrSin:Math.sin,twrCos:Math.cos,twrTan:Math.tan,twrFAbs:Math.abs,twrACos:Math.acos,twrASin:Math.asin,twrATan:Math.atan,twrExp:Math.exp,twrFloor:Math.floor,twrCeil:Math.ceil,twrFMod:function(e,t){return e%t},twrLog:Math.log,twrPow:Math.pow,twrSqrt:Math.sqrt,twrTrunc:Math.trunc,twrDtoa:this.floatUtil.dtoa.bind(this.floatUtil),twrToFixed:this.floatUtil.toFixed.bind(this.floatUtil),twrToExponential:this.floatUtil.toExponential.bind(this.floatUtil),twrAtod:this.floatUtil.atod.bind(this.floatUtil),twrFcvtS:this.floatUtil.fcvtS.bind(this.floatUtil)}}async loadWasm(e){return super.loadWasm(e,this.imports,this.ioNamesToID)}}
//# sourceMappingURL=twrmodasyncproxy.83da80bb.js.map
